import{k as tt,A as ht,p as jt,_ as vt,r as q,B as kt,o as et,c as _t,w as St,C as At,i as U,b as h,t as nt,d as N,z as it,j as Ft,g as xt,L as Dt,F as Mt}from"./index-3fa98f99.js";import{g as Tt}from"./settings-b0007178.js";const Pt="/hyperquark/assets/hyperquark_bg-d6eff7e5.wasm",Ct=async(t={},e)=>{let o;if(e.startsWith("data:")){const s=e.replace(/^data:.*?base64,/,"");let a;if(typeof tt.Buffer=="function"&&typeof tt.Buffer.from=="function")a=tt.Buffer.from(s,"base64");else if(typeof atob=="function"){const w=atob(s);a=new Uint8Array(w.length);for(let c=0;c<w.length;c++)a[c]=w.charCodeAt(c)}else throw new Error("Cannot decode base64-encoded data URL");o=await WebAssembly.instantiate(a,t)}else{const s=await fetch(e),a=s.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&a.startsWith("application/wasm"))o=await WebAssembly.instantiateStreaming(s,t);else{const w=await s.arrayBuffer();o=await WebAssembly.instantiate(w,t)}}return o.instance.exports};let i;function It(t){i=t}const Ot=typeof TextDecoder>"u"?(0,module.require)("util").TextDecoder:TextDecoder;let ft=new Ot("utf-8",{ignoreBOM:!0,fatal:!0});ft.decode();let G=null;function W(){return(G===null||G.byteLength===0)&&(G=new Uint8Array(i.memory.buffer)),G}function J(t,e){return t=t>>>0,ft.decode(W().subarray(t,t+e))}const D=new Array(128).fill(void 0);D.push(void 0,null,!0,!1);let B=D.length;function f(t){B===D.length&&D.push(D.length+1);const e=B;return B=D[e],D[e]=t,e}function l(t){return D[t]}function Ut(t){t<132||(D[t]=B,B=t)}function X(t){const e=l(t);return Ut(t),e}let M=0;const Vt=typeof TextEncoder>"u"?(0,module.require)("util").TextEncoder:TextEncoder;let H=new Vt("utf-8");const Wt=typeof H.encodeInto=="function"?function(t,e){return H.encodeInto(t,e)}:function(t,e){const o=H.encode(t);return e.set(o),{read:t.length,written:o.length}};function bt(t,e,o){if(o===void 0){const y=H.encode(t),k=e(y.length,1)>>>0;return W().subarray(k,k+y.length).set(y),M=y.length,k}let s=t.length,a=e(s,1)>>>0;const w=W();let c=0;for(;c<s;c++){const y=t.charCodeAt(c);if(y>127)break;w[a+c]=y}if(c!==s){c!==0&&(t=t.slice(c)),a=o(a,s,s=c+t.length*3,1)>>>0;const y=W().subarray(a+c,a+s),k=Wt(t,y);c+=k.written,a=o(a,s,c,1)>>>0}return M=c,a}function Et(t){return t==null}let V=null;function v(){return(V===null||V.buffer.detached===!0||V.buffer.detached===void 0&&V.buffer!==i.memory.buffer)&&(V=new DataView(i.memory.buffer)),V}function Lt(t,e){return t=t>>>0,W().subarray(t/1,t/1+e)}function zt(t,e){const o=e(t.length*1,1)>>>0;return W().set(t,o/1),M=t.length,o}function ct(t,e){t=t>>>0;const o=v(),s=[];for(let a=t;a<t+4*e;a+=4)s.push(X(o.getUint32(a,!0)));return s}function lt(t,e){const o=e(t.length*4,4)>>>0,s=v();for(let a=0;a<t.length;a++)s.setUint32(o+4*a,f(t[a]),!0);return M=t.length,o}function qt(t){try{const a=i.__wbindgen_add_to_stack_pointer(-16),w=bt(t,i.__wbindgen_malloc,i.__wbindgen_realloc),c=M;i.sb3_to_wasm(a,w,c);var e=v().getInt32(a+4*0,!0),o=v().getInt32(a+4*1,!0),s=v().getInt32(a+4*2,!0);if(s)throw X(o);return Y.__wrap(e)}finally{i.__wbindgen_add_to_stack_pointer(16)}}function T(t,e){try{return t.apply(this,e)}catch(o){i.__wbindgen_exn_store(f(o))}}const ut=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>i.__wbg_wasmproject_free(t>>>0,1));class Y{static __wrap(e){e=e>>>0;const o=Object.create(Y.prototype);return o.__wbg_ptr=e,ut.register(o,o.__wbg_ptr,o),o}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ut.unregister(this),e}free(){const e=this.__destroy_into_raw();i.__wbg_wasmproject_free(e,0)}get wasm_bytes(){try{const a=i.__wbindgen_add_to_stack_pointer(-16);i.__wbg_get_wasmproject_wasm_bytes(a,this.__wbg_ptr);var e=v().getInt32(a+4*0,!0),o=v().getInt32(a+4*1,!0),s=Lt(e,o).slice();return i.__wbindgen_free(e,o*1,1),s}finally{i.__wbindgen_add_to_stack_pointer(16)}}set wasm_bytes(e){const o=zt(e,i.__wbindgen_malloc),s=M;i.__wbg_set_wasmproject_wasm_bytes(this.__wbg_ptr,o,s)}get string_consts(){try{const a=i.__wbindgen_add_to_stack_pointer(-16);i.__wbg_get_wasmproject_string_consts(a,this.__wbg_ptr);var e=v().getInt32(a+4*0,!0),o=v().getInt32(a+4*1,!0),s=ct(e,o).slice();return i.__wbindgen_free(e,o*4,4),s}finally{i.__wbindgen_add_to_stack_pointer(16)}}set string_consts(e){const o=lt(e,i.__wbindgen_malloc),s=M;i.__wbg_set_wasmproject_string_consts(this.__wbg_ptr,o,s)}get target_names(){try{const a=i.__wbindgen_add_to_stack_pointer(-16);i.__wbg_get_wasmproject_target_names(a,this.__wbg_ptr);var e=v().getInt32(a+4*0,!0),o=v().getInt32(a+4*1,!0),s=ct(e,o).slice();return i.__wbindgen_free(e,o*4,4),s}finally{i.__wbindgen_add_to_stack_pointer(16)}}set target_names(e){const o=lt(e,i.__wbindgen_malloc),s=M;i.__wbg_set_wasmproject_target_names(this.__wbg_ptr,o,s)}}function Bt(t,e){console.log(J(t,e))}function Rt(t,e){const o=J(t,e);return f(o)}function $t(t){const e=l(t);return typeof e=="object"&&e!==null}function Nt(t){const e=l(t).crypto;return f(e)}function Gt(t){const e=l(t).process;return f(e)}function Ht(t){const e=l(t).versions;return f(e)}function Jt(t){const e=l(t).node;return f(e)}function Xt(t){return typeof l(t)=="string"}function Yt(){return T(function(){const t=module.require;return f(t)},arguments)}function Kt(t){const e=l(t).msCrypto;return f(e)}function Qt(){return T(function(t,e){l(t).randomFillSync(X(e))},arguments)}function Zt(){return T(function(t,e){l(t).getRandomValues(l(e))},arguments)}function te(t){X(t)}function ee(t,e){const o=new Function(J(t,e));return f(o)}function ne(t){return typeof l(t)=="function"}function oe(){return T(function(){const t=self.self;return f(t)},arguments)}function re(){return T(function(){const t=window.window;return f(t)},arguments)}function se(){return T(function(){const t=globalThis.globalThis;return f(t)},arguments)}function ae(){return T(function(){const t=ht.global;return f(t)},arguments)}function _e(t){return l(t)===void 0}function ie(){return T(function(t,e){const o=l(t).call(l(e));return f(o)},arguments)}function ce(){return T(function(t,e,o){const s=l(t).call(l(e),l(o));return f(s)},arguments)}function le(t){const e=l(t).buffer;return f(e)}function ue(t,e,o){const s=new Uint8Array(l(t),e>>>0,o>>>0);return f(s)}function fe(t){const e=new Uint8Array(l(t));return f(e)}function be(t){const e=new Uint8Array(t>>>0);return f(e)}function we(t,e,o){const s=l(t).subarray(e>>>0,o>>>0);return f(s)}function ge(t,e,o){l(t).set(l(e),o>>>0)}function de(t){const e=l(t);return f(e)}function me(t,e){const o=l(e),s=typeof o=="string"?o:void 0;var a=Et(s)?0:bt(s,i.__wbindgen_malloc,i.__wbindgen_realloc),w=M;v().setInt32(t+4*1,w,!0),v().setInt32(t+4*0,a,!0)}function pe(t,e){throw new Error(J(t,e))}function ye(){const t=i.memory;return f(t)}URL=globalThis.URL;const j=await Ct({"./hyperquark_bg.js":{__wbg_log_47c1fb3058e7df32:Bt,__wbindgen_string_new:Rt,__wbindgen_is_object:$t,__wbg_crypto_1d1f22824a6a080c:Nt,__wbg_process_4a72847cc503995b:Gt,__wbg_versions_f686565e586dd935:Ht,__wbg_node_104a2ff8d6ea03a2:Jt,__wbindgen_is_string:Xt,__wbg_require_cca90b1a94a0255b:Yt,__wbg_msCrypto_eb05e62b530a1508:Kt,__wbg_randomFillSync_5c9c955aa56b6049:Qt,__wbg_getRandomValues_3aa56aa6edec874c:Zt,__wbindgen_object_drop_ref:te,__wbg_newnoargs_76313bd6ff35d0f2:ee,__wbindgen_is_function:ne,__wbg_self_3093d5d1f7bcb682:oe,__wbg_window_3bcfc4d31bc012f8:re,__wbg_globalThis_86b222e13bdf32ed:se,__wbg_global_e5a3fe56f8be9485:ae,__wbindgen_is_undefined:_e,__wbg_call_1084a111329e68ce:ie,__wbg_call_89af060b4e1523f2:ce,__wbg_buffer_b7b08af79b0b0974:le,__wbg_newwithbyteoffsetandlength_8a2cb9ca96b27ec9:ue,__wbg_new_ea1883e1e5e86686:fe,__wbg_newwithlength_ec548f448387c968:be,__wbg_subarray_7c2e3576afe181d1:we,__wbg_set_d1e79e2388520f18:ge,__wbindgen_object_clone_ref:de,__wbindgen_string_get:me,__wbindgen_throw:pe,__wbindgen_memory:ye}},Pt),he=j.memory,je=j.__wbg_wasmproject_free,ve=j.__wbg_get_wasmproject_wasm_bytes,ke=j.__wbg_set_wasmproject_wasm_bytes,Se=j.__wbg_get_wasmproject_string_consts,Ae=j.__wbg_set_wasmproject_string_consts,Fe=j.__wbg_get_wasmproject_target_names,xe=j.__wbg_set_wasmproject_target_names,De=j.sb3_to_wasm,Me=j.__wbindgen_malloc,Te=j.__wbindgen_realloc,Pe=j.__wbindgen_add_to_stack_pointer,Ce=j.__wbindgen_free,Ie=j.__wbindgen_exn_store,Oe=Object.freeze(Object.defineProperty({__proto__:null,__wbg_get_wasmproject_string_consts:Se,__wbg_get_wasmproject_target_names:Fe,__wbg_get_wasmproject_wasm_bytes:ve,__wbg_set_wasmproject_string_consts:Ae,__wbg_set_wasmproject_target_names:xe,__wbg_set_wasmproject_wasm_bytes:ke,__wbg_wasmproject_free:je,__wbindgen_add_to_stack_pointer:Pe,__wbindgen_exn_store:Ie,__wbindgen_free:Ce,__wbindgen_malloc:Me,__wbindgen_realloc:Te,memory:he,sb3_to_wasm:De},Symbol.toStringTag,{value:"Module"}));It(Oe);function ot(t,e,o,...s){let a=t.createDrawable(o.toString());const w={pen:"Pen",text:"Text",svg:"SVG"}[e.toLowerCase()];let c=t[`create${w}Skin`](...s);return t.updateDrawableSkinId(a,c),[c,a]}const p=80,Ue=async({framerate:t=30,renderer:e,wasm_bytes:o,target_names:s,string_consts:a,project_json:w,assets:c}={framerate:30})=>{window.debug&&window.open(URL.createObjectURL(new Blob([o],{type:"application/wasm"})));const y=Math.round(1e3/t);let k,P=!1,x,E;e.getDrawable=n=>e._allDrawables[n],e.getSkin=n=>e._allSkins[n];const R=w.targets.map((n,r)=>n.costumes.map(({md5ext:_})=>c[_]));w.targets.map(n=>Object.fromEntries(n.costumes.map(({name:r},_)=>[r,_]))),window.renderer=e,e.setLayerGroupOrdering(["background","video","pen","sprite"]);const L=ot(e,"pen","pen")[0];typeof require>"u"?(P=!0,x=document.querySelector("div#hq-output"),E=n=>Object.assign(document.createElement("div"),{textContent:n}),k=n=>{if(!n)throw new AssertionError("Assertion failed")}):(jt.exit,k=require("node:assert"));let g;const u=s.map(n=>null),A=w.targets.map((n,r)=>{const _=n.costumes[n.currentCostume],m=R[r][n.currentCostume],[S,C]=ot(e,m[0],"sprite",m[1],[_.rotationCenterX,_.rotationCenterY]),F=e.getDrawable(C);return n.is_stage||(F.updateVisible(n.visible),F.updatePosition([n.x,n.y]),F.updateDirection(n.rotation),F.updateScale([n.size,n.size])),[S,C]});console.log(A);const O=(n,r)=>n===0?new Float64Array(new BigInt64Array([r]).buffer)[0]:n===1?!!r:n===2?g.get(Number(r)):null,K=(...n)=>{const r=O(...n);P?x.appendChild(E("output: "+String(r))):console.log("output: \x1B[34m%s\x1B[0m",r)},Q=(...n)=>{const r=O(...n);P?x.appendChild(E("assert: "+String(r))):console.log("assert: \x1B[34m%s\x1B[0m",r)},rt=(n,r,_)=>{console.log("a",n,r,_);let m=s[n];P?u[n]===null?u[n]=ot(e,"text","sprite",r,_,!1):e.updateTextSkin(u[n][0],r,_,!1):console.log(`\x1B[1;32m${m} ${r}:\x1B[0m \x1B[35m${_}\x1B[0m`)};let st,Z=0,d=0;const at=[...Tt()["js-string-builtins"]?["js-string"]:[]],wt={dbg:{log:K,assert:Q,logi32(n){return console.log("logi32: %d",n),n}},runtime:{looks_say:(n,r,_)=>{rt(_,"say",O(n,r).toString())},looks_think:(n,r,_)=>{rt(_,"think",O(n,r).toString())},operator_random:(n,r)=>Math.random()*(r-n)+n,operator_letterof:(n,r)=>r.toString()[n-1]??"",operator_contains:(n,r)=>n.toString().toLowerCase().includes(r.toString().toLowerCase()),mathop_sin:n=>parseFloat(Math.sin(Math.PI*n/180).toFixed(10)),mathop_cos:n=>parseFloat(Math.cos(Math.PI*n/180).toFixed(10)),mathop_tan:n=>{switch(n=n%360,n){case-270:case 90:return 1/0;case-90:case 270:return-1/0;default:return parseFloat(Math.tan(Math.PI*n/180).toFixed(10))}},mathop_asin:n=>Math.asin(n)*180/Math.PI,mathop_acos:n=>Math.acos(n)*180/Math.PI,mathop_atan:n=>Math.atan(n)*180/Math.PI,mathop_ln:n=>Math.log(n),mathop_log:n=>Math.log(n)/Math.LN10,mathop_pow_e:n=>Math.exp(n),mathop_pow10:n=>Math.pow(10,n),sensing_timer:()=>(Date.now()-Z)/1e3,sensing_resettimer:()=>Z=Date.now(),sensing_dayssince2000(){const r=new Date(2e3,0,1),_=new Date,m=_.getTimezoneOffset()-r.getTimezoneOffset();let S=_.valueOf()-r.valueOf();return S+=(_.getTimezoneOffset()-m)*60*1e3,S/864e5},pen_clear:()=>e.penClear(L),pen_down:(n,r,_,m,S,C,F)=>e.penPoint(L,{diameter:n,color4f:[m,S,C,F]},r,_),pen_lineto:(n,r,_,m,S,C,F,$,z)=>e.penLine(L,{diameter:n,color4f:[C,F,$,z]},r,_,m,S),pen_up:()=>null,pen_setcolor:()=>null,pen_changecolorparam:()=>null,pen_setcolorparam:(n,r,_)=>{switch(n){case"color":new DataView(memory.buffer).setFloat32(d+(_-1)*p+16,r,!0);break;case"saturation":new DataView(memory.buffer).setFloat32(d+(_-1)*p+20,r,!0);break;case"brightness":new DataView(memory.buffer).setFloat32(d+(_-1)*p+24,r,!0);break;case"transparency":new DataView(memory.buffer).setFloat32(d+(_-1)*p+28,r,!0);break;default:console.warn(`can't update invalid color param ${n}`)}st(_)},pen_changesize:()=>null,pen_changehue:()=>null,pen_sethue:()=>null,emit_sprite_pos_change:n=>{const r=new Float64Array(memory.buffer)[(d+(n-1)*p)/8],_=new Float64Array(memory.buffer)[(d+(n-1)*p+8)/8];e.getDrawable(A[n][1]).updatePosition([r,_])},emit_sprite_x_change:n=>null,emit_sprite_y_change:n=>null,emit_sprite_size_change:n=>{const r=new Float64Array(memory.buffer)[(d+(n-1)*p+64)/8];e.getDrawable(A[n][1]).updateScale([r,r])},emit_sprite_costume_change:n=>{const r=new Int32Array(memory.buffer)[(d+(n-1)*p+60)/4],_=R[n][r];e.getSkin(A[n][0]).setSVG(_[1])},emit_sprite_rotation_change:n=>{const r=new Float64Array(memory.buffer)[(d+(n-1)*p+72)/8];e.getDrawable(A[n][1]).updateDirection(r)},emit_sprite_visibility_change:n=>{e.getDrawable(A[n][1]).updateVisible(!!new Uint8Array(memory.buffer)[d+(n-1)*p+57])}},cast:{stringtofloat:parseFloat,stringtobool:Boolean,floattostring:n=>n.toString()},"wasm:js-string":{equals(n,r){return n===r},length(n){return n.length},concat(n,r){return n.concat(r)}}};try{k(WebAssembly.validate(o,{builtins:at}))}catch{try{throw new WebAssembly.Module(o),new Error("invalid WASM module")}catch(n){throw new Error("invalid WASM module: "+n.message)}}function gt(n){return new Promise(r=>{setTimeout(r,n)})}function dt(){return new Promise(n=>{requestAnimationFrame(n)})}WebAssembly.instantiate(o,wt,{builtins:at}).then(async({instance:n})=>{const{green_flag:r,tick:_,memory:m,strings:S,step_funcs:C,vars_num:F,rr_offset:$,thn_offset:z,upc:mt,unreachable_dbg:pt}=n.exports;for(const[b,yt]of Object.entries(a))S.set(b,yt);st=b=>mt(b-1),g=S,window.memory=m,window.stop=()=>{for(let b=0;b<new Uint32Array(m.buffer)[z.value/4];b++)new Uint32Array(m.buffer)[(b+d+p*(s.length-1))/4]=0},d=F.value*16+z+4;const I=new DataView(m.buffer);for(let b=0;b<s.length-1;b++)I.setFloat32(d+b*p+16,66.66,!0),I.setFloat32(d+b*p+20,100,!0),I.setFloat32(d+b*p+24,100,!0),I.setFloat32(d+b*p+28,0,!0),I.setFloat32(d+b*p+40,1,!0),I.setFloat32(d+b*p+44,1,!0),I.setFloat64(d+b*p+48,1,!0);try{pt()}catch(b){console.info("synthetic error to exose wasm modulee to devtools:",b)}r(),Z=Date.now(),console.log("green_flag()");t:for(;;){e.draw();const b=Date.now();do if(_(),new Uint32Array(m.buffer)[z.value/4]===0)break t;while(Date.now()-b<y*.8&&new Uint8Array(m.buffer)[$.value]===0);new Uint8Array(m.buffer)[$.value]=0,y>0?await gt(Math.max(0,y-(Date.now()-b))):await dt()}}).catch(n=>{throw new Error(`error when instantiating module:
`+n.stack)})};const Ve=["value"],We={key:0},Ee=["innerHTML"],Le={__name:"ProjectPlayer",props:["json","title","author","assets","zip"],setup(t){const e=window.ScratchRender,o=t;let s=q(null),a=q(!1),w=q(null),c=q("loading assets"),y=q(!1),k=null,P,x;const E=async g=>{try{return o.zip?await o.zip.file(g).async("text"):await(await fetch(`https://assets.scratch.mit.edu/internalapi/asset/${g}/get/`)).text()}catch(u){s.value=`failed to load asset ${g}
${u.stack}`}};kt(()=>{P=new e(w.value)});try{if(x=qt(JSON.stringify(o.json)),!x instanceof Y)throw new Error("unknown error occurred when compiling project")}catch(g){s.value=g.toString(),g.stack&&(s.value+=`
`+g.stack)}Promise.all(o.json.targets.map(g=>new Promise(u=>Promise.all(g.costumes.map(({md5ext:A,dataFormat:O})=>new Promise(K=>E(A).then(Q=>K([A,[O,Q]]))))).then(u)))).then(g=>{k=Object.fromEntries(g.flat()),y.value=!0});function R(){Ue({framerate:a?1/0:30,renderer:P,wasm_bytes:x.wasm_bytes,string_consts:x.string_consts,target_names:x.target_names,project_json:o.json,assets:k}).catch(g=>{s.value=g.toString(),g.stack&&(s.value+=`
`+g.stack)})}function L(){window.stop()}return(g,u)=>(et(),_t(Mt,null,[St(h("div",null,[h("h1",null,nt(o.title||"untitled"),1),h("span",null,"by "+nt(o.author||"unknown"),1),h("input",{type:"checkbox",id:"turbo",value:U(a)},null,8,Ve),u[1]||(u[1]=N()),u[2]||(u[2]=h("label",{for:"turbo"},"turbo mode",-1)),U(s)?(et(),_t("details",We,[u[0]||(u[0]=h("summary",null,"An error occured whilst trying to load the project.",-1)),h("span",{innerHTML:U(s)},null,8,Ee)])):it("",!0),u[3]||(u[3]=h("br",null,null,-1)),u[4]||(u[4]=h("br",null,null,-1)),h("button",{onClick:R},"green flag"),u[5]||(u[5]=N()),h("button",{onClick:L},"stop"),h("canvas",{width:"480",height:"360",ref_key:"canvas",ref:w},null,512),u[6]||(u[6]=h("div",{id:"hq-output"},[N("Project output:"),h("br")],-1))],512),[[At,U(y)]]),U(y)?it("",!0):(et(),Ft(Dt,{key:0},{default:xt(()=>[N(nt(U(c)),1)]),_:1}))],64))}},Re=vt(Le,[["__scopeId","data-v-a2adca93"]]);export{Re as P};
