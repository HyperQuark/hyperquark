const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BQSu9TUU.js","assets/index-CaQpwfau.js","assets/index-Ctl5uw3g.css","assets/index-BAMY2Nnw.js","assets/index-OUawxo1V.js","assets/scratch-render-DlCm_D2T.js","assets/_commonjsHelpers-DsqdWQfm.js"])))=>i.map(i=>d[i]);
import{_ as Me,q as Te,r as O,s as De,l as me,c as N,o as z,h as Ee,k as Oe,x as J,y as Le,u as y,a as u,t as L,d as Z,w as Ce,L as Pe,F as ze}from"./index-CaQpwfau.js";import{_ as Ie,g as te,W as Re}from"./settings-DIuLJAxo.js";const Ve="/hyperquark/non-warped-procs/assets/hyperquark_bg-B0HuUzvj.wasm";let s;function $e(t){s=t}function ye(t){const e=s.__externref_table_alloc();return s.__wbindgen_externrefs.set(e,t),e}function We(t,e){if(!(t instanceof e))throw new Error(`expected instance of ${e.name}`)}function ce(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const r=t.description;return r==null?"Symbol":`Symbol(${r})`}if(e=="function"){const r=t.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(t)){const r=t.length;let a="[";r>0&&(a+=ce(t[0]));for(let c=1;c<r;c++)a+=", "+ce(t[c]);return a+="]",a}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let _;if(n&&n.length>1)_=n[1];else return toString.call(t);if(_=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:_}function ge(t,e){t=t>>>0;const n=D(),_=[];for(let r=t;r<t+4*e;r+=4)_.push(s.__wbindgen_externrefs.get(n.getUint32(r,!0)));return s.__externref_drop_slice(t,e),_}function fe(t,e){return t=t>>>0,R().subarray(t/1,t/1+e)}let I=null;function D(){return(I===null||I.buffer.detached===!0||I.buffer.detached===void 0&&I.buffer!==s.memory.buffer)&&(I=new DataView(s.memory.buffer)),I}function T(t,e){return t=t>>>0,Ne(t,e)}let ee=null;function R(){return(ee===null||ee.byteLength===0)&&(ee=new Uint8Array(s.memory.buffer)),ee}function Be(t,e){try{return t.apply(this,e)}catch(n){const _=ye(n);s.__wbindgen_exn_store(_)}}function se(t){return t==null}function Ue(t,e){const n=e(t.length*1,1)>>>0;return R().set(t,n/1),b=t.length,n}function le(t,e){const n=e(t.length*4,4)>>>0;for(let _=0;_<t.length;_++){const r=ye(t[_]);D().setUint32(n+4*_,r,!0)}return b=t.length,n}function M(t,e,n){if(n===void 0){const w=G.encode(t),i=e(w.length,1)>>>0;return R().subarray(i,i+w.length).set(w),b=w.length,i}let _=t.length,r=e(_,1)>>>0;const a=R();let c=0;for(;c<_;c++){const w=t.charCodeAt(c);if(w>127)break;a[r+c]=w}if(c!==_){c!==0&&(t=t.slice(c)),r=n(r,_,_=c+t.length*3,1)>>>0;const w=R().subarray(r+c,r+_),i=G.encodeInto(t,w);c+=i.written,r=n(r,_,c,1)>>>0}return b=c,r}function V(t){const e=s.__wbindgen_externrefs.get(t);return s.__externref_table_dealloc(t),e}let ne=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});ne.decode();const qe=2146435072;let ie=0;function Ne(t,e){return ie+=e,ie>=qe&&(ne=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),ne.decode(),ie=e),ne.decode(R().subarray(t,t+e))}const G=new TextEncoder;"encodeInto"in G||(G.encodeInto=function(t,e){const n=G.encode(t);return e.set(n),{read:t.length,written:n.length}});let b=0;const pe=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>s.__wbg_finishedwasm_free(t>>>0,1)),he=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>s.__wbg_flaginfo_free(t>>>0,1)),ae=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>s.__wbg_wasmflags_free(t>>>0,1));class ${static __wrap(e){e=e>>>0;const n=Object.create($.prototype);return n.__wbg_ptr=e,pe.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,pe.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_finishedwasm_free(e,0)}get wasm_bytes(){const e=s.__wbg_get_finishedwasm_wasm_bytes(this.__wbg_ptr);var n=fe(e[0],e[1]).slice();return s.__wbindgen_free(e[0],e[1]*1,1),n}set wasm_bytes(e){const n=Ue(e,s.__wbindgen_malloc),_=b;s.__wbg_set_finishedwasm_wasm_bytes(this.__wbg_ptr,n,_)}get target_names(){const e=s.__wbg_get_finishedwasm_target_names(this.__wbg_ptr);var n=ge(e[0],e[1]).slice();return s.__wbindgen_free(e[0],e[1]*4,4),n}set target_names(e){const n=le(e,s.__wbindgen_malloc),_=b;s.__wbg_set_finishedwasm_target_names(this.__wbg_ptr,n,_)}get strings(){const e=s.__wbg_get_finishedwasm_strings(this.__wbg_ptr);var n=ge(e[0],e[1]).slice();return s.__wbindgen_free(e[0],e[1]*4,4),n}set strings(e){const n=le(e,s.__wbindgen_malloc),_=b;s.__wbg_set_finishedwasm_strings(this.__wbg_ptr,n,_)}}Symbol.dispose&&($.prototype[Symbol.dispose]=$.prototype.free);class X{static __wrap(e){e=e>>>0;const n=Object.create(X.prototype);return n.__wbg_ptr=e,he.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,he.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_flaginfo_free(e,0)}get name(){let e,n;try{const _=s.__wbg_get_flaginfo_name(this.__wbg_ptr);return e=_[0],n=_[1],T(_[0],_[1])}finally{s.__wbindgen_free(e,n,1)}}set name(e){const n=M(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=b;s.__wbg_set_flaginfo_name(this.__wbg_ptr,n,_)}get description(){let e,n;try{const _=s.__wbg_get_flaginfo_description(this.__wbg_ptr);return e=_[0],n=_[1],T(_[0],_[1])}finally{s.__wbindgen_free(e,n,1)}}set description(e){const n=M(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=b;s.__wbg_set_flaginfo_description(this.__wbg_ptr,n,_)}get ty(){let e,n;try{const _=s.__wbg_get_flaginfo_ty(this.__wbg_ptr);return e=_[0],n=_[1],T(_[0],_[1])}finally{s.__wbindgen_free(e,n,1)}}set ty(e){const n=M(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=b;s.__wbg_set_flaginfo_ty(this.__wbg_ptr,n,_)}wasm_features(e){const n=M(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=b,r=s.flaginfo_wasm_features(this.__wbg_ptr,n,_);let a;return r[0]!==0&&(a=ge(r[0],r[1]).slice(),s.__wbindgen_free(r[0],r[1]*4,4)),a}to_js(){const e=s.flaginfo_to_js(this.__wbg_ptr);if(e[2])throw V(e[1]);return V(e[0])}}Symbol.dispose&&(X.prototype[Symbol.dispose]=X.prototype.free);class C{static __wrap(e){e=e>>>0;const n=Object.create(C.prototype);return n.__wbg_ptr=e,ae.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ae.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_wasmflags_free(e,0)}get string_type(){return s.__wbg_get_wasmflags_string_type(this.__wbg_ptr)}set string_type(e){s.__wbg_set_wasmflags_string_type(this.__wbg_ptr,e)}get wasm_opt(){return s.__wbg_get_wasmflags_wasm_opt(this.__wbg_ptr)}set wasm_opt(e){s.__wbg_set_wasmflags_wasm_opt(this.__wbg_ptr,e)}get print_ir(){return s.__wbg_get_wasmflags_print_ir(this.__wbg_ptr)}set print_ir(e){s.__wbg_set_wasmflags_print_ir(this.__wbg_ptr,e)}get integers(){return s.__wbg_get_wasmflags_integers(this.__wbg_ptr)}set integers(e){s.__wbg_set_wasmflags_integers(this.__wbg_ptr,e)}get list_type(){return s.__wbg_get_wasmflags_list_type(this.__wbg_ptr)}set list_type(e){s.__wbg_set_wasmflags_list_type(this.__wbg_ptr,e)}constructor(e){const n=le(e,s.__wbindgen_malloc),_=b,r=s.wasmflags_new(n,_);return this.__wbg_ptr=r>>>0,ae.register(this,this.__wbg_ptr,this),this}to_js(){const e=s.wasmflags_to_js(this.__wbg_ptr);if(e[2])throw V(e[1]);return V(e[0])}static from_js(e){const n=s.wasmflags_from_js(e);if(n[2])throw V(n[1]);return C.__wrap(n[0])}static flag_info(e){const n=M(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=b,r=s.wasmflags_flag_info(n,_);return X.__wrap(r)}}Symbol.dispose&&(C.prototype[Symbol.dispose]=C.prototype.free);function Je(t,e){const n=M(t,s.__wbindgen_malloc,s.__wbindgen_realloc),_=b;We(e,C);var r=e.__destroy_into_raw();const a=s.sb3_to_wasm(n,_,r);if(a[2])throw V(a[1]);return $.__wrap(a[0])}function Ge(t,e){return Error(T(t,e))}function He(t){const e=t,n=typeof e=="boolean"?e:void 0;return se(n)?16777215:n?1:0}function Xe(t,e){const n=ce(e),_=M(n,s.__wbindgen_malloc,s.__wbindgen_realloc),r=b;D().setInt32(t+4,r,!0),D().setInt32(t+0,_,!0)}function Ye(t,e){return t in e}function Ke(t){const e=t;return typeof e=="object"&&e!==null}function Qe(t){return typeof t=="string"}function Ze(t){return t===void 0}function et(t,e){return t==e}function tt(t,e){const n=e,_=typeof n=="number"?n:void 0;D().setFloat64(t+8,se(_)?0:_,!0),D().setInt32(t+0,!se(_),!0)}function nt(t,e){const n=e,_=typeof n=="string"?n:void 0;var r=se(_)?0:M(_,s.__wbindgen_malloc,s.__wbindgen_realloc),a=b;D().setInt32(t+4,a,!0),D().setInt32(t+0,r,!0)}function _t(t,e){throw new Error(T(t,e))}function st(t){let e;try{e=+t}catch(_){e=_}return e}function rt(t){return Object.entries(t)}function ot(){return Be(function(t,e){globalThis.crypto.getRandomValues(fe(t,e))},arguments)}function it(t,e){return t[e>>>0]}function at(t,e){return t[e]}function ct(t){let e;try{e=t instanceof ArrayBuffer}catch{e=!1}return e}function gt(t){let e;try{e=t instanceof Uint8Array}catch{e=!1}return e}function lt(t){return t.length}function ft(t){return t.length}function wt(t,e){console.log(T(t,e))}function ut(){return new Object}function bt(){return new Array}function dt(t){return new Uint8Array(t)}function mt(){return new Map}function pt(t,e,n){Uint8Array.prototype.set.call(fe(t,e),n)}function ht(t,e,n){t[e]=n}function yt(t,e,n){t[e>>>0]=n}function kt(t,e,n){return t.set(e,n)}function jt(t,e){console.warn(T(t,e))}function St(t,e){return T(t,e)}function vt(t){return t}function xt(){const t=s.__wbindgen_externrefs,e=t.grow(4);t.set(0,void 0),t.set(e+0,void 0),t.set(e+1,null),t.set(e+2,!0),t.set(e+3,!1)}URL=globalThis.URL;const o=await Ie({"./hyperquark_bg.js":{__wbg_warn_0bdfa102b24897af:jt,__wbg_log_82092b5186d6cbab:wt,__wbg_set_3f1d0b984ed272ed:ht,__wbg_get_with_ref_key_1dc361bd10053bfe:at,__wbg_new_25f239778d6112b9:bt,__wbg_get_6b7bd52aca3f9671:it,__wbg_set_7df433eea03a5c14:yt,__wbg_length_d45040a40c570362:ft,__wbg_new_b546ae120718850e:mt,__wbg_set_efaaf145b9377369:kt,__wbg_entries_83c79938054e065f:rt,__wbg_new_1ba21ce319a06297:ut,__wbg_prototypesetcall_dfe9b766cdc1f1fd:pt,__wbg_new_6421f6084cc5bc5a:dt,__wbg_length_22ac23eaec9d8053:lt,__wbg_instanceof_Uint8Array_da54ccc9d3e09434:gt,__wbg_instanceof_ArrayBuffer_f3320d2419cd0355:ct,__wbg_getRandomValues_9b655bdd369112f2:ot,__wbg___wbindgen_in_0d3e1e8f0c669317:Ye,__wbg___wbindgen_throw_dd24417ed36fc46e:_t,__wbg_Error_52673b7de5a0ca89:Ge,__wbg___wbindgen_is_object_ce774f3490692386:Ke,__wbg___wbindgen_is_string_704ef9c8fc131030:Qe,__wbg___wbindgen_number_get_9619185a74197f95:tt,__wbg___wbindgen_string_get_a2a31e16edf96e42:nt,__wbg___wbindgen_boolean_get_dea25b33882b895b:He,__wbg___wbindgen_is_undefined_f6b95eab589e0269:Ze,__wbg___wbindgen_jsval_loose_eq_766057600fdd1b0d:et,__wbg___wbindgen_try_into_number_9d33ffe037a9f5e5:st,__wbg___wbindgen_debug_string_adfb662ae34724b6:Xe,__wbindgen_init_externref_table:xt,__wbindgen_cast_2241b6af4c4b2941:St,__wbindgen_cast_d6cd19b81560fd6e:vt}},Ve),At=o.memory,Ft=o.sb3_to_wasm,Mt=o.__wbg_finishedwasm_free,Tt=o.__wbg_get_finishedwasm_strings,Dt=o.__wbg_get_finishedwasm_target_names,Et=o.__wbg_get_finishedwasm_wasm_bytes,Ot=o.__wbg_set_finishedwasm_strings,Lt=o.__wbg_set_finishedwasm_target_names,Ct=o.__wbg_set_finishedwasm_wasm_bytes,Pt=o.__wbg_flaginfo_free,zt=o.__wbg_get_flaginfo_description,It=o.__wbg_get_flaginfo_name,Rt=o.__wbg_get_flaginfo_ty,Vt=o.__wbg_get_wasmflags_integers,$t=o.__wbg_get_wasmflags_list_type,Wt=o.__wbg_get_wasmflags_print_ir,Bt=o.__wbg_get_wasmflags_string_type,Ut=o.__wbg_get_wasmflags_wasm_opt,qt=o.__wbg_set_flaginfo_description,Nt=o.__wbg_set_flaginfo_name,Jt=o.__wbg_set_flaginfo_ty,Gt=o.__wbg_set_wasmflags_integers,Ht=o.__wbg_set_wasmflags_list_type,Xt=o.__wbg_set_wasmflags_print_ir,Yt=o.__wbg_set_wasmflags_string_type,Kt=o.__wbg_set_wasmflags_wasm_opt,Qt=o.__wbg_wasmflags_free,Zt=o.all_wasm_features,en=o.flaginfo_to_js,tn=o.flaginfo_wasm_features,nn=o.wasm_feature_detect_name,_n=o.wasmflags_flag_info,sn=o.wasmflags_from_js,rn=o.wasmflags_new,on=o.wasmflags_to_js,an=o.__wbindgen_malloc,cn=o.__wbindgen_realloc,gn=o.__wbindgen_exn_store,ln=o.__externref_table_alloc,fn=o.__wbindgen_externrefs,wn=o.__externref_table_dealloc,un=o.__wbindgen_free,bn=o.__externref_drop_slice,ke=o.__wbindgen_start,dn=Object.freeze(Object.defineProperty({__proto__:null,__externref_drop_slice:bn,__externref_table_alloc:ln,__externref_table_dealloc:wn,__wbg_finishedwasm_free:Mt,__wbg_flaginfo_free:Pt,__wbg_get_finishedwasm_strings:Tt,__wbg_get_finishedwasm_target_names:Dt,__wbg_get_finishedwasm_wasm_bytes:Et,__wbg_get_flaginfo_description:zt,__wbg_get_flaginfo_name:It,__wbg_get_flaginfo_ty:Rt,__wbg_get_wasmflags_integers:Vt,__wbg_get_wasmflags_list_type:$t,__wbg_get_wasmflags_print_ir:Wt,__wbg_get_wasmflags_string_type:Bt,__wbg_get_wasmflags_wasm_opt:Ut,__wbg_set_finishedwasm_strings:Ot,__wbg_set_finishedwasm_target_names:Lt,__wbg_set_finishedwasm_wasm_bytes:Ct,__wbg_set_flaginfo_description:qt,__wbg_set_flaginfo_name:Nt,__wbg_set_flaginfo_ty:Jt,__wbg_set_wasmflags_integers:Gt,__wbg_set_wasmflags_list_type:Ht,__wbg_set_wasmflags_print_ir:Xt,__wbg_set_wasmflags_string_type:Yt,__wbg_set_wasmflags_wasm_opt:Kt,__wbg_wasmflags_free:Qt,__wbindgen_exn_store:gn,__wbindgen_externrefs:fn,__wbindgen_free:un,__wbindgen_malloc:an,__wbindgen_realloc:cn,__wbindgen_start:ke,all_wasm_features:Zt,flaginfo_to_js:en,flaginfo_wasm_features:tn,memory:At,sb3_to_wasm:Ft,wasm_feature_detect_name:nn,wasmflags_flag_info:_n,wasmflags_from_js:sn,wasmflags_new:rn,wasmflags_to_js:on},Symbol.toStringTag,{value:"Module"}));$e(dn);ke();let _e,we=!1,H,re,je,Se,ve;function mn(t,e,n,_,r){_e=t,H=_e.map(a=>null),console.log(_e,H),re=e,je=n,Se=_,ve=r,we=!0}function pn(){return we}function W(){if(!we)throw new Error("shared state must be set up before use!")}function B(){return W(),_e}function A(){return W(),re}function ue(){return W(),je}function Y(){return W(),Se}function hn(){return W(),ve}function U(t,e,n){W(),H[t]?re.updateTextSkin(H[t][0],e,n,!1):H[t]=re.createSkin("text","sprite",e,n,!1)}function yn(t,e,n,_,r,a,c,w,i){A().penLine(ue(),{diameter:t,color4f:[a,c,w,i]},e,n,_,r)}function kn(){A().penClear(ue())}function jn(t,e,n,_,r,a,c){A().penPoint(ue(),{diameter:t,color4f:[_,r,a,c]},e,n)}function Sn(t){return Math.log(t)}function vn(t){return Math.sin(t)}function xn(t,e){return t.toLowerCase()===e.toLowerCase()}function An(t,e){return t.toLowerCase().includes(e.toLowerCase())}function Fn(){return Math.random()}function Mn(t){return Math.acos(t)}function Tn(t){return Math.asin(t)}function Dn(t){return Math.atan(t)}function En(t){return Math.cos(t)}function On(t){return Math.pow(10,t)}function Ln(t){switch(t=t%360,t){case-270:case 90:return 1/0;case-90:case 270:return-1/0;default:return Math.tan(Math.PI*t/180)}}function Cn(t,e){return t.toLowerCase()<e.toLowerCase()}function Pn(t,e){return t.toLowerCase()>e.toLowerCase()}function zn(t){return Math.exp(t)}function In(t,e,n){return t.substring(e,n)}function Rn(t){return t.length}function Vn(t,e){return t.concat(e)}function $n(){const e=new Date(2e3,0,1),n=new Date,_=n.getTimezoneOffset()-e.getTimezoneOffset();let r=n.valueOf()-e.valueOf();return r+=(n.getTimezoneOffset()-_)*60*1e3,r/864e5}function Wn(t){return parseFloat(t)}function Bn(t){return t.toString()}function Un(t){return t.toString()}function qn(t,e){console.log("%s thinks: %d",B()[e],t)}function Nn(t,e){A().getDrawable(Y()[e][1]).updateScale([t,t])}function Jn(t,e){console.log("%s says: %s",B()[e],t)}function Gn(t,e){U(e,"say",t.toString())}function Hn(t,e){U(e,"say",t)}function Xn(t,e){const n=hn()[e][t];A().getSkin(Y()[e][0]).setSVG(n.data)}function Yn(t,e){U(e,"say",t.toString())}function Kn(t,e){U(e,"think",t.toString())}function Qn(t,e){console.log("%s says: %d",B()[e],t)}function Zn(t,e){U(e,"think",t)}function e_(t,e){console.log("%s says: %d",B()[e],t)}function t_(t,e){console.log("%s thinks: %s",B()[e],t)}function n_(t,e){A().getDrawable(Y()[e][1]).updateVisible(t)}function __(t,e){console.log("%s thinks: %d",B()[e],t)}function s_(t,e){U(e,"think",t.toString())}function r_(t,e){A().getDrawable(Y()[t][1]).updateDirection(e)}function o_(t,e,n){A().getDrawable(Y()[n][1]).updatePosition([t,e])}const i_={looks:{think_debug_float:qn,setsizeto:Nn,say_debug_string:Jn,say_int:Gn,say_string:Hn,switchcostumeto:Xn,say_float:Yn,think_float:Kn,say_debug_int:Qn,think_string:Zn,say_debug_float:e_,think_debug_string:t_,setvisible:n_,think_debug_int:__,think_int:s_},motion:{pointindirection:r_,gotoxy:o_},"wasm:js-string":{substring:In,length:Rn,concat:Vn},pen:{line:yn,clear:kn,point:jn},sensing:{dayssince2000:$n},operator:{log:Sn,sin:vn,eq_string:xn,contains:An,random:Fn,acos:Mn,asin:Tn,atan:Dn,cos:En,pow10:On,tan:Ln,lt_string:Cn,gt_string:Pn,exp:zn},cast:{string2float:Wn,float2string:Bn,int2string:Un}};function a_(t,e,n,..._){let r=t.createDrawable(n.toString());const a={pen:"Pen",text:"Text",svg:"SVG"}[e.toLowerCase()];let c=t[`create${a}Skin`](..._);return t.updateDrawableSkinId(r,c),[c,r]}async function c_(t,e,n,_){if(pn())return;let r=await t();r.getDrawable=i=>r._allDrawables[i],r.getSkin=i=>r._allSkins[i],r.createSkin=(i,p,...h)=>a_(r,i,p,...h);const a=e.targets.map((i,p)=>i.costumes.map(({md5ext:h})=>n[h]));typeof window=="object"&&(window.renderer=r),r.setLayerGroupOrdering(["background","video","pen","sprite"]);const c=r.createSkin("pen","pen")[0],w=e.targets.map((i,p)=>{const h=i.costumes[i.currentCostume],k=a[p][i.currentCostume];if(k.dataFormat.toLowerCase()!=="svg")throw new Error("todo: non-svg costumes");const[F,j]=r.createSkin(k.dataFormat,"sprite",k.data,[h.rotationCenterX,h.rotationCenterY]),d=r.getDrawable(j);return i.is_stage||(d.updateVisible(!!i.visible),d.updatePosition([i.x,i.y]),d.updateDirection(i.direction),d.updateScale([i.size,i.size])),[F,j]});console.log(w),mn(_,r,c,w,a)}async function g_({framerate:t=30,turbo:e,wasm_bytes:n,target_names:_,strings:r,project_json:a,assets:c,makeRenderer:w,isDebug:i=()=>!1,timeout:p,onTimeout:h=()=>null,importOverrides:k}){i()&&typeof window=="object"&&window.open(URL.createObjectURL(new Blob([n],{type:"application/wasm"}))),await c_(w,a,c,_);const F=A();console.log("project setup complete");const j=Math.round(1e3/t),d=te(),l=[...Re[d.string_type]==="JsStringBuiltins"?["js-string"]:[]],S=Object.assign(i_,{"":Object.fromEntries(r.map(f=>[f,f]))});console.log(k);for(const[f,q]of Object.entries(k??{}))for(const[Ae,Fe]of Object.entries(k[f]))S[f][Ae]=Fe;try{if(!WebAssembly.validate(n,{builtins:l}))throw Error()}catch{try{throw new WebAssembly.Module(n),new Error("invalid WASM module")}catch(f){throw new Error("invalid WASM module: "+f.message)}}function x(f){return new Promise(q=>{setTimeout(q,f)})}function g(){return new Promise(f=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(f):setTimeout(f,1)})}let{instance:m}=await WebAssembly.instantiate(n,S,{builtins:l,importedStringConstants:""});const{flag_clicked:v,tick:E,memory:oe,threads_count:K,requests_refresh:Q,threads:be,unreachable_dbg:xe}=m.exports;typeof window=="object"&&(window.memory=oe,window.flag_clicked=v,window.tick=E);try{xe()}catch(f){console.info("synthetic error to expose wasm module to devtools:",f)}let P=!1;const de=async()=>{if(console.log("running"),P)return;P=!0,F.draw();let f=Date.now();e:for(;P;){if(p&&Date.now()-f>p)return h();let q=Date.now();do if(E(),K.value===0)break e;while(Date.now()-q<j*.8&&!e&&Q.value===0);Q.value=0,F.draw(),j>0?await x(Math.max(0,j-(Date.now()-q))):await g()}F.draw(),P=!1,console.log("project stopped (or maybe paused)")};return{greenFlag:()=>{console.log("green flag clicked"),v(),de()},flag_clicked:v,stop:()=>{console.log("stopping"),K.value=0,P=!1;for(let f=0;f<be.length;f++)be.set(f,null)},pause:()=>{P=!1},run:de}}const l_={key:0},f_=["href"],w_=["href"],u_={key:1},b_=["innerHTML"],d_=["value"],m_={class:"instructions"},p_={key:0},h_={key:1},y_={__name:"ProjectPlayer",props:["json","title","author","assets","zip","instructions","description","id"],setup(t){const e=Te(),n=t;let _=O(null),r=O("loading"),a=O("An error"),c=O(!1),w=O(null),i=O("compiling project"),p=O(!1),h=()=>null,k=()=>null,F=!0;const j=(d,l,S,x,g)=>{console.error(d),a.value=S,r.value=x,_.value=d.toString(),d.stack&&(_.value+="<br>"+d.stack),g&&(_.value+=g),l&&(F=!1,p.value=!0)};return De(async()=>{const d=async g=>{try{return n.zip?(console.log(n.zip),await(n.zip.file(g)??n.zip.files[g]).async("text")):await(await fetch(`https://assets.scratch.mit.edu/internalapi/asset/${g}/get/`)).text()}catch(m){_.value=`failed to load asset ${g}
${m.stack}`}};let l,S=null,x;try{if(x=Je(JSON.stringify(n.json),C.from_js(te().to_js())),!x instanceof $)throw new Error("unknown error occurred when compiling project");l=x.wasm_bytes}catch(g){j(g,!0,"An error","compiling")}if(F){if(te().to_js().wasm_opt=="On")try{i.value="optimising project",console.log(te().to_js().scheduler);const g=(await me(async()=>{const{default:v}=await import("./index-BQSu9TUU.js");return{default:v}},__vite__mapDeps([0,1,2,3,4]))).default,m=g.readBinary(l);m.setFeatures(g.Features.All),g.setOptimizeLevel(3),g.setShrinkLevel(0),m.runPasses(["generate-global-effects"]),m.optimize(),m.optimize(),l=m.emitBinary()}catch(g){j(g,!1,"A warning","optimising","<br>See browser console for more info.        <brThis might not be an unrecoverable error; the project may play         as normal (possibly with worse-than-expected performance).")}else console.log("skipping wasm-opt due to user settings");try{i.value="loading assets";const g=await Promise.all(n.json.targets.map(m=>new Promise(v=>Promise.all(m.costumes.map(({md5ext:E,dataFormat:oe})=>new Promise(K=>d(E).then(Q=>K([E,{dataFormat:oe,data:Q}]))))).then(v))));S=Object.fromEntries(g.flat())}catch(g){j(g,!1,"A warning","loading assets for")}try{i.value="instantiating project";const g=await g_({framerate:30,turbo:c.value,wasm_bytes:l,strings:x.strings,target_names:x.target_names,project_json:n.json,assets:S,makeRenderer:async()=>{const v=(await me(()=>import("./scratch-render-DlCm_D2T.js").then(E=>E.s),__vite__mapDeps([5,6]))).default;return new v(w.value)},isDebug:()=>e.debug});p.value=!0,h=g.greenFlag,k=g.stop}catch(g){j(g,!0,"An error","instantiating")}}}),(d,l)=>(z(),N(ze,null,[Ee(u("div",null,[u("h1",null,L(n.title||"untitled"),1),u("span",null,"by "+L(n.author||"unknown"),1),t.id?(z(),N("div",l_,[u("a",{href:`https://scratch.mit.edu/projects/${n.id}/`},"View on Scratch",8,f_),l[2]||(l[2]=Z(" | ",-1)),u("a",{href:`https://turbowarp.org/${n.id}/`},"View on TurboWarp",8,w_)])):J("",!0),y(_)?(z(),N("details",u_,[u("summary",null,L(y(a))+" was emitted whilst "+L(y(r))+" project. ",1),u("span",{innerHTML:y(_)},null,8,b_)])):J("",!0),u("div",null,[u("button",{onClick:l[0]||(l[0]=(...S)=>y(h)&&y(h)(...S))},"green flag"),u("button",{onClick:l[1]||(l[1]=(...S)=>y(k)&&y(k)(...S))},"stop"),u("input",{type:"checkbox",id:"turbo",value:y(c)},null,8,d_),l[3]||(l[3]=u("label",{for:"turbo"},"turbo mode",-1))]),u("canvas",{width:"480",height:"360",ref_key:"canvas",ref:w},null,512),u("div",m_,[n.instructions?(z(),N("div",p_,[l[4]||(l[4]=u("h2",null,"Instructions",-1)),Z(" "+L(n.instructions),1)])):J("",!0),n.description?(z(),N("div",h_,[l[5]||(l[5]=u("h2",null,"Notes and credits",-1)),Z(" "+L(n.description),1)])):J("",!0)])],512),[[Le,y(p)]]),y(p)?J("",!0):(z(),Oe(Pe,{key:0},{default:Ce(()=>[Z(L(y(i)),1)]),_:1}))],64))}},S_=Me(y_,[["__scopeId","data-v-0968b477"]]);export{S_ as P};
