const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/scratch-render-DlCm_D2T.js","assets/_commonjsHelpers-DsqdWQfm.js","assets/index-L0kWujx6.js","assets/index-Dg3pXe8K.js","assets/index-Ctl5uw3g.css","assets/index-BAMY2Nnw.js","assets/index-OUawxo1V.js"])))=>i.map(i=>d[i]);
import{q as je,l as de,_ as xe,r as D,p as Ae,c as U,o as O,h as Fe,k as De,s as q,x as Me,u as S,a as u,t as M,d as K,w as Te,L as Ee,F as Oe}from"./index-Dg3pXe8K.js";import{_ as Le,g as Z,W as Ce}from"./settings-BCpWtH8I.js";const Pe="/hyperquark/lists/assets/hyperquark_bg-npWTtAcK.wasm";let r;function ze(t){r=t}function me(t){const e=r.__externref_table_alloc();return r.__wbindgen_externrefs.set(e,t),e}function Ie(t,e){if(!(t instanceof e))throw new Error(`expected instance of ${e.name}`)}function ie(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const s=t.description;return s==null?"Symbol":`Symbol(${s})`}if(e=="function"){const s=t.name;return typeof s=="string"&&s.length>0?`Function(${s})`:"Function"}if(Array.isArray(t)){const s=t.length;let a="[";s>0&&(a+=ie(t[0]));for(let c=1;c<s;c++)a+=", "+ie(t[c]);return a+="]",a}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let _;if(n&&n.length>1)_=n[1];else return toString.call(t);if(_=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:_}function ae(t,e){t=t>>>0;const n=x(),_=[];for(let s=t;s<t+4*e;s+=4)_.push(r.__wbindgen_externrefs.get(n.getUint32(s,!0)));return r.__externref_drop_slice(t,e),_}function ge(t,e){return t=t>>>0,C().subarray(t/1,t/1+e)}let L=null;function x(){return(L===null||L.buffer.detached===!0||L.buffer.detached===void 0&&L.buffer!==r.memory.buffer)&&(L=new DataView(r.memory.buffer)),L}function j(t,e){return t=t>>>0,Re(t,e)}let Q=null;function C(){return(Q===null||Q.byteLength===0)&&(Q=new Uint8Array(r.memory.buffer)),Q}function Ve(t,e){try{return t.apply(this,e)}catch(n){const _=me(n);r.__wbindgen_exn_store(_)}}function ne(t){return t==null}function Be(t,e){const n=e(t.length*1,1)>>>0;return C().set(t,n/1),b=t.length,n}function ce(t,e){const n=e(t.length*4,4)>>>0;for(let _=0;_<t.length;_++){const s=me(t[_]);x().setUint32(n+4*_,s,!0)}return b=t.length,n}function v(t,e,n){if(n===void 0){const w=N.encode(t),i=e(w.length,1)>>>0;return C().subarray(i,i+w.length).set(w),b=w.length,i}let _=t.length,s=e(_,1)>>>0;const a=C();let c=0;for(;c<_;c++){const w=t.charCodeAt(c);if(w>127)break;a[s+c]=w}if(c!==_){c!==0&&(t=t.slice(c)),s=n(s,_,_=c+t.length*3,1)>>>0;const w=C().subarray(s+c,s+_),i=N.encodeInto(t,w);c+=i.written,s=n(s,_,c,1)>>>0}return b=c,s}function P(t){const e=r.__wbindgen_externrefs.get(t);return r.__externref_table_dealloc(t),e}let ee=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});ee.decode();const We=2146435072;let re=0;function Re(t,e){return re+=e,re>=We&&(ee=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),ee.decode(),re=e),ee.decode(C().subarray(t,t+e))}const N=new TextEncoder;"encodeInto"in N||(N.encodeInto=function(t,e){const n=N.encode(t);return e.set(n),{read:t.length,written:n.length}});let b=0;const ue=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>r.__wbg_finishedwasm_free(t>>>0,1)),be=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>r.__wbg_flaginfo_free(t>>>0,1)),oe=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>r.__wbg_wasmflags_free(t>>>0,1));class z{static __wrap(e){e=e>>>0;const n=Object.create(z.prototype);return n.__wbg_ptr=e,ue.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,ue.unregister(this),e}free(){const e=this.__destroy_into_raw();r.__wbg_finishedwasm_free(e,0)}get wasm_bytes(){const e=r.__wbg_get_finishedwasm_wasm_bytes(this.__wbg_ptr);var n=ge(e[0],e[1]).slice();return r.__wbindgen_free(e[0],e[1]*1,1),n}set wasm_bytes(e){const n=Be(e,r.__wbindgen_malloc),_=b;r.__wbg_set_finishedwasm_wasm_bytes(this.__wbg_ptr,n,_)}get target_names(){const e=r.__wbg_get_finishedwasm_target_names(this.__wbg_ptr);var n=ae(e[0],e[1]).slice();return r.__wbindgen_free(e[0],e[1]*4,4),n}set target_names(e){const n=ce(e,r.__wbindgen_malloc),_=b;r.__wbg_set_finishedwasm_target_names(this.__wbg_ptr,n,_)}get strings(){const e=r.__wbg_get_finishedwasm_strings(this.__wbg_ptr);var n=ae(e[0],e[1]).slice();return r.__wbindgen_free(e[0],e[1]*4,4),n}set strings(e){const n=ce(e,r.__wbindgen_malloc),_=b;r.__wbg_set_finishedwasm_strings(this.__wbg_ptr,n,_)}}Symbol.dispose&&(z.prototype[Symbol.dispose]=z.prototype.free);class G{static __wrap(e){e=e>>>0;const n=Object.create(G.prototype);return n.__wbg_ptr=e,be.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,be.unregister(this),e}free(){const e=this.__destroy_into_raw();r.__wbg_flaginfo_free(e,0)}get name(){let e,n;try{const _=r.__wbg_get_flaginfo_name(this.__wbg_ptr);return e=_[0],n=_[1],j(_[0],_[1])}finally{r.__wbindgen_free(e,n,1)}}set name(e){const n=v(e,r.__wbindgen_malloc,r.__wbindgen_realloc),_=b;r.__wbg_set_flaginfo_name(this.__wbg_ptr,n,_)}get description(){let e,n;try{const _=r.__wbg_get_flaginfo_description(this.__wbg_ptr);return e=_[0],n=_[1],j(_[0],_[1])}finally{r.__wbindgen_free(e,n,1)}}set description(e){const n=v(e,r.__wbindgen_malloc,r.__wbindgen_realloc),_=b;r.__wbg_set_flaginfo_description(this.__wbg_ptr,n,_)}get ty(){let e,n;try{const _=r.__wbg_get_flaginfo_ty(this.__wbg_ptr);return e=_[0],n=_[1],j(_[0],_[1])}finally{r.__wbindgen_free(e,n,1)}}set ty(e){const n=v(e,r.__wbindgen_malloc,r.__wbindgen_realloc),_=b;r.__wbg_set_flaginfo_ty(this.__wbg_ptr,n,_)}wasm_features(e){const n=v(e,r.__wbindgen_malloc,r.__wbindgen_realloc),_=b,s=r.flaginfo_wasm_features(this.__wbg_ptr,n,_);let a;return s[0]!==0&&(a=ae(s[0],s[1]).slice(),r.__wbindgen_free(s[0],s[1]*4,4)),a}to_js(){const e=r.flaginfo_to_js(this.__wbg_ptr);if(e[2])throw P(e[1]);return P(e[0])}}Symbol.dispose&&(G.prototype[Symbol.dispose]=G.prototype.free);class T{static __wrap(e){e=e>>>0;const n=Object.create(T.prototype);return n.__wbg_ptr=e,oe.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,oe.unregister(this),e}free(){const e=this.__destroy_into_raw();r.__wbg_wasmflags_free(e,0)}get string_type(){return r.__wbg_get_wasmflags_string_type(this.__wbg_ptr)}set string_type(e){r.__wbg_set_wasmflags_string_type(this.__wbg_ptr,e)}get wasm_opt(){return r.__wbg_get_wasmflags_wasm_opt(this.__wbg_ptr)}set wasm_opt(e){r.__wbg_set_wasmflags_wasm_opt(this.__wbg_ptr,e)}get scheduler(){return r.__wbg_get_wasmflags_scheduler(this.__wbg_ptr)}set scheduler(e){r.__wbg_set_wasmflags_scheduler(this.__wbg_ptr,e)}get print_ir(){return r.__wbg_get_wasmflags_print_ir(this.__wbg_ptr)}set print_ir(e){r.__wbg_set_wasmflags_print_ir(this.__wbg_ptr,e)}get integers(){return r.__wbg_get_wasmflags_integers(this.__wbg_ptr)}set integers(e){r.__wbg_set_wasmflags_integers(this.__wbg_ptr,e)}get list_type(){return r.__wbg_get_wasmflags_list_type(this.__wbg_ptr)}set list_type(e){r.__wbg_set_wasmflags_list_type(this.__wbg_ptr,e)}constructor(e){const n=ce(e,r.__wbindgen_malloc),_=b,s=r.wasmflags_new(n,_);return this.__wbg_ptr=s>>>0,oe.register(this,this.__wbg_ptr,this),this}to_js(){const e=r.wasmflags_to_js(this.__wbg_ptr);if(e[2])throw P(e[1]);return P(e[0])}static from_js(e){const n=r.wasmflags_from_js(e);if(n[2])throw P(n[1]);return T.__wrap(n[0])}static flag_info(e){const n=v(e,r.__wbindgen_malloc,r.__wbindgen_realloc),_=b,s=r.wasmflags_flag_info(n,_);return G.__wrap(s)}}Symbol.dispose&&(T.prototype[Symbol.dispose]=T.prototype.free);function $e(t,e){const n=v(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=b;Ie(e,T);var s=e.__destroy_into_raw();const a=r.sb3_to_wasm(n,_,s);if(a[2])throw P(a[1]);return z.__wrap(a[0])}function Ue(t,e){return Error(j(t,e))}function qe(t){const e=t,n=typeof e=="boolean"?e:void 0;return ne(n)?16777215:n?1:0}function Ne(t,e){const n=ie(e),_=v(n,r.__wbindgen_malloc,r.__wbindgen_realloc),s=b;x().setInt32(t+4,s,!0),x().setInt32(t+0,_,!0)}function Je(t,e){return t in e}function Ge(t){const e=t;return typeof e=="object"&&e!==null}function He(t){return typeof t=="string"}function Xe(t){return t===void 0}function Ye(t,e){return t==e}function Ke(t,e){const n=e,_=typeof n=="number"?n:void 0;x().setFloat64(t+8,ne(_)?0:_,!0),x().setInt32(t+0,!ne(_),!0)}function Qe(t,e){const n=e,_=typeof n=="string"?n:void 0;var s=ne(_)?0:v(_,r.__wbindgen_malloc,r.__wbindgen_realloc),a=b;x().setInt32(t+4,a,!0),x().setInt32(t+0,s,!0)}function Ze(t,e){throw new Error(j(t,e))}function et(t){let e;try{e=+t}catch(_){e=_}return e}function tt(t){return Object.entries(t)}function nt(){return Ve(function(t,e){globalThis.crypto.getRandomValues(ge(t,e))},arguments)}function _t(t,e){return t[e>>>0]}function st(t,e){return t[e]}function rt(t){let e;try{e=t instanceof ArrayBuffer}catch{e=!1}return e}function ot(t){let e;try{e=t instanceof Uint8Array}catch{e=!1}return e}function it(t){return t.length}function at(t){return t.length}function ct(t,e){console.log(j(t,e))}function gt(){return new Object}function lt(){return new Array}function ft(t){return new Uint8Array(t)}function wt(){return new Map}function ut(t,e,n){Uint8Array.prototype.set.call(ge(t,e),n)}function bt(t,e,n){t[e]=n}function dt(t,e,n){t[e>>>0]=n}function mt(t,e,n){return t.set(e,n)}function pt(t,e){console.warn(j(t,e))}function ht(t,e){return j(t,e)}function yt(t){return t}function kt(){const t=r.__wbindgen_externrefs,e=t.grow(4);t.set(0,void 0),t.set(e+0,void 0),t.set(e+1,null),t.set(e+2,!0),t.set(e+3,!1)}URL=globalThis.URL;const o=await Le({"./hyperquark_bg.js":{__wbg_log_82092b5186d6cbab:ct,__wbg_warn_0bdfa102b24897af:pt,__wbg_set_3f1d0b984ed272ed:bt,__wbg_get_with_ref_key_1dc361bd10053bfe:st,__wbg_new_25f239778d6112b9:lt,__wbg_get_6b7bd52aca3f9671:_t,__wbg_set_7df433eea03a5c14:dt,__wbg_length_d45040a40c570362:at,__wbg_new_b546ae120718850e:wt,__wbg_set_efaaf145b9377369:mt,__wbg_entries_83c79938054e065f:tt,__wbg_new_1ba21ce319a06297:gt,__wbg_prototypesetcall_dfe9b766cdc1f1fd:ut,__wbg_new_6421f6084cc5bc5a:ft,__wbg_length_22ac23eaec9d8053:it,__wbg_instanceof_Uint8Array_da54ccc9d3e09434:ot,__wbg_instanceof_ArrayBuffer_f3320d2419cd0355:rt,__wbg_getRandomValues_9b655bdd369112f2:nt,__wbg___wbindgen_in_0d3e1e8f0c669317:Je,__wbg___wbindgen_throw_dd24417ed36fc46e:Ze,__wbg_Error_52673b7de5a0ca89:Ue,__wbg___wbindgen_is_object_ce774f3490692386:Ge,__wbg___wbindgen_is_string_704ef9c8fc131030:He,__wbg___wbindgen_number_get_9619185a74197f95:Ke,__wbg___wbindgen_string_get_a2a31e16edf96e42:Qe,__wbg___wbindgen_boolean_get_dea25b33882b895b:qe,__wbg___wbindgen_is_undefined_f6b95eab589e0269:Xe,__wbg___wbindgen_jsval_loose_eq_766057600fdd1b0d:Ye,__wbg___wbindgen_try_into_number_9d33ffe037a9f5e5:et,__wbg___wbindgen_debug_string_adfb662ae34724b6:Ne,__wbindgen_init_externref_table:kt,__wbindgen_cast_d6cd19b81560fd6e:yt,__wbindgen_cast_2241b6af4c4b2941:ht}},Pe),St=o.memory,vt=o.sb3_to_wasm,jt=o.__wbg_finishedwasm_free,xt=o.__wbg_get_finishedwasm_strings,At=o.__wbg_get_finishedwasm_target_names,Ft=o.__wbg_get_finishedwasm_wasm_bytes,Dt=o.__wbg_set_finishedwasm_strings,Mt=o.__wbg_set_finishedwasm_target_names,Tt=o.__wbg_set_finishedwasm_wasm_bytes,Et=o.__wbg_flaginfo_free,Ot=o.__wbg_get_flaginfo_description,Lt=o.__wbg_get_flaginfo_name,Ct=o.__wbg_get_flaginfo_ty,Pt=o.__wbg_get_wasmflags_integers,zt=o.__wbg_get_wasmflags_list_type,It=o.__wbg_get_wasmflags_print_ir,Vt=o.__wbg_get_wasmflags_scheduler,Bt=o.__wbg_get_wasmflags_string_type,Wt=o.__wbg_get_wasmflags_wasm_opt,Rt=o.__wbg_set_flaginfo_description,$t=o.__wbg_set_flaginfo_name,Ut=o.__wbg_set_flaginfo_ty,qt=o.__wbg_set_wasmflags_integers,Nt=o.__wbg_set_wasmflags_list_type,Jt=o.__wbg_set_wasmflags_print_ir,Gt=o.__wbg_set_wasmflags_scheduler,Ht=o.__wbg_set_wasmflags_string_type,Xt=o.__wbg_set_wasmflags_wasm_opt,Yt=o.__wbg_wasmflags_free,Kt=o.all_wasm_features,Qt=o.flaginfo_to_js,Zt=o.flaginfo_wasm_features,en=o.wasm_feature_detect_name,tn=o.wasmflags_flag_info,nn=o.wasmflags_from_js,_n=o.wasmflags_new,sn=o.wasmflags_to_js,rn=o.__wbindgen_malloc,on=o.__wbindgen_realloc,an=o.__wbindgen_exn_store,cn=o.__externref_table_alloc,gn=o.__wbindgen_externrefs,ln=o.__externref_table_dealloc,fn=o.__wbindgen_free,wn=o.__externref_drop_slice,pe=o.__wbindgen_start,un=Object.freeze(Object.defineProperty({__proto__:null,__externref_drop_slice:wn,__externref_table_alloc:cn,__externref_table_dealloc:ln,__wbg_finishedwasm_free:jt,__wbg_flaginfo_free:Et,__wbg_get_finishedwasm_strings:xt,__wbg_get_finishedwasm_target_names:At,__wbg_get_finishedwasm_wasm_bytes:Ft,__wbg_get_flaginfo_description:Ot,__wbg_get_flaginfo_name:Lt,__wbg_get_flaginfo_ty:Ct,__wbg_get_wasmflags_integers:Pt,__wbg_get_wasmflags_list_type:zt,__wbg_get_wasmflags_print_ir:It,__wbg_get_wasmflags_scheduler:Vt,__wbg_get_wasmflags_string_type:Bt,__wbg_get_wasmflags_wasm_opt:Wt,__wbg_set_finishedwasm_strings:Dt,__wbg_set_finishedwasm_target_names:Mt,__wbg_set_finishedwasm_wasm_bytes:Tt,__wbg_set_flaginfo_description:Rt,__wbg_set_flaginfo_name:$t,__wbg_set_flaginfo_ty:Ut,__wbg_set_wasmflags_integers:qt,__wbg_set_wasmflags_list_type:Nt,__wbg_set_wasmflags_print_ir:Jt,__wbg_set_wasmflags_scheduler:Gt,__wbg_set_wasmflags_string_type:Ht,__wbg_set_wasmflags_wasm_opt:Xt,__wbg_wasmflags_free:Yt,__wbindgen_exn_store:an,__wbindgen_externrefs:gn,__wbindgen_free:fn,__wbindgen_malloc:rn,__wbindgen_realloc:on,__wbindgen_start:pe,all_wasm_features:Kt,flaginfo_to_js:Qt,flaginfo_wasm_features:Zt,memory:St,sb3_to_wasm:vt,wasm_feature_detect_name:en,wasmflags_flag_info:tn,wasmflags_from_js:nn,wasmflags_new:_n,wasmflags_to_js:sn},Symbol.toStringTag,{value:"Module"}));ze(un);pe();let te,le=!1,J,_e,he,ye,ke;function bn(t,e,n,_,s){te=t,J=te.map(a=>null),console.log(te,J),_e=e,he=n,ye=_,ke=s,le=!0}function dn(){return le}function I(){if(!le)throw new Error("shared state must be set up before use!")}function V(){return I(),te}function k(){return I(),_e}function fe(){return I(),he}function H(){return I(),ye}function mn(){return I(),ke}function B(t,e,n){I(),J[t]?_e.updateTextSkin(J[t][0],e,n,!1):J[t]=_e.createSkin("text","sprite",e,n,!1)}function pn(t,e,n,_,s,a,c,w,i){k().penLine(fe(),{diameter:t,color4f:[a,c,w,i]},e,n,_,s)}function hn(){k().penClear(fe())}function yn(t,e,n,_,s,a,c){k().penPoint(fe(),{diameter:t,color4f:[_,s,a,c]},e,n)}function kn(t){return Math.log(t)}function Sn(t){return Math.sin(t)}function vn(t,e){return t.toLowerCase()===e.toLowerCase()}function jn(t,e){return t.toLowerCase().includes(e.toLowerCase())}function xn(){return Math.random()}function An(t){return Math.acos(t)}function Fn(t){return Math.asin(t)}function Dn(t){return Math.atan(t)}function Mn(t){return Math.cos(t)}function Tn(t){return Math.pow(10,t)}function En(t){switch(t=t%360,t){case-270:case 90:return 1/0;case-90:case 270:return-1/0;default:return Math.tan(Math.PI*t/180)}}function On(t,e){return t.toLowerCase()<e.toLowerCase()}function Ln(t,e){return t.toLowerCase()>e.toLowerCase()}function Cn(t){return Math.exp(t)}function Pn(t,e,n){return t.substring(e,n)}function zn(t){return t.length}function In(t,e){return t.concat(e)}function Vn(){const e=new Date(2e3,0,1),n=new Date,_=n.getTimezoneOffset()-e.getTimezoneOffset();let s=n.valueOf()-e.valueOf();return s+=(n.getTimezoneOffset()-_)*60*1e3,s/864e5}function Bn(t){return parseFloat(t)}function Wn(t){return t.toString()}function Rn(t){return t.toString()}function $n(t,e){console.log("%s thinks: %d",V()[e],t)}function Un(t,e){k().getDrawable(H()[e][1]).updateScale([t,t])}function qn(t,e){console.log("%s says: %s",V()[e],t)}function Nn(t,e){B(e,"say",t.toString())}function Jn(t,e){B(e,"say",t)}function Gn(t,e){const n=mn()[e][t];k().getSkin(H()[e][0]).setSVG(n.data)}function Hn(t,e){B(e,"say",t.toString())}function Xn(t,e){B(e,"think",t.toString())}function Yn(t,e){console.log("%s says: %d",V()[e],t)}function Kn(t,e){B(e,"think",t)}function Qn(t,e){console.log("%s says: %d",V()[e],t)}function Zn(t,e){console.log("%s thinks: %s",V()[e],t)}function e_(t,e){k().getDrawable(H()[e][1]).updateVisible(t)}function t_(t,e){console.log("%s thinks: %d",V()[e],t)}function n_(t,e){B(e,"think",t.toString())}function __(t,e){k().getDrawable(H()[t][1]).updateDirection(e)}function s_(t,e,n){k().getDrawable(H()[n][1]).updatePosition([t,e])}const r_={looks:{think_debug_float:$n,setsizeto:Un,say_debug_string:qn,say_int:Nn,say_string:Jn,switchcostumeto:Gn,say_float:Hn,think_float:Xn,say_debug_int:Yn,think_string:Kn,say_debug_float:Qn,think_debug_string:Zn,setvisible:e_,think_debug_int:t_,think_int:n_},pen:{line:pn,clear:hn,point:yn},operator:{log:kn,sin:Sn,eq_string:vn,contains:jn,random:xn,acos:An,asin:Fn,atan:Dn,cos:Mn,pow10:Tn,tan:En,lt_string:On,gt_string:Ln,exp:Cn},sensing:{dayssince2000:Vn},motion:{pointindirection:__,gotoxy:s_},"wasm:js-string":{substring:Pn,length:zn,concat:In},cast:{string2float:Bn,float2string:Wn,int2string:Rn}},o_=await de(()=>import("./scratch-render-DlCm_D2T.js").then(t=>t.s),__vite__mapDeps([0,1])),i_=o_.default,a_=je();function c_(t,e,n,..._){let s=t.createDrawable(n.toString());const a={pen:"Pen",text:"Text",svg:"SVG"}[e.toLowerCase()];let c=t[`create${a}Skin`](..._);return t.updateDrawableSkinId(s,c),[c,s]}function g_(t,e,n,_){if(dn())return;let s=new i_(t);s.getDrawable=i=>s._allDrawables[i],s.getSkin=i=>s._allSkins[i],s.createSkin=(i,m,...d)=>c_(s,i,m,...d);const a=e.targets.map((i,m)=>i.costumes.map(({md5ext:d})=>n[d]));e.targets.map(i=>Object.fromEntries(i.costumes.map(({name:m},d)=>[m,d]))),window.renderer=s,s.setLayerGroupOrdering(["background","video","pen","sprite"]);const c=s.createSkin("pen","pen")[0],w=e.targets.map((i,m)=>{const d=i.costumes[i.currentCostume],h=a[m][i.currentCostume];if(h.dataFormat.toLowerCase()!=="svg")throw new Error("todo: non-svg costumes");const[p,E]=s.createSkin(h.dataFormat,"sprite",h.data,[d.rotationCenterX,d.rotationCenterY]),f=s.getDrawable(E);return i.is_stage||(f.updateVisible(!!i.visible),f.updatePosition([i.x,i.y]),f.updateDirection(i.direction),f.updateScale([i.size,i.size])),[p,E]});console.log(w),bn(_,s,c,w,a)}const l_=async({framerate:t=30,turbo:e,canvas:n,wasm_bytes:_,target_names:s,string_consts:a,project_json:c,assets:w}={framerate:30,turbo:!1})=>{a_.debug&&window.open(URL.createObjectURL(new Blob([_],{type:"application/wasm"})));const i=Math.round(1e3/t);console.log("framerate_wait: %i",i),g_(n,c,w,s);const m=k();console.log("green flag setup complete");const d=Z(),h=[...Ce[d.string_type]==="JsStringBuiltins"?["js-string"]:[]];try{if(!WebAssembly.validate(_,{builtins:h}))throw Error()}catch{try{throw new WebAssembly.Module(_),new Error("invalid WASM module")}catch(f){throw new Error("invalid WASM module: "+f.message)}}function p(f){return new Promise(y=>{setTimeout(y,f)})}function E(){return new Promise(f=>{requestAnimationFrame(f)})}WebAssembly.instantiate(_,r_,{builtins:h,importedStringConstants:""}).then(async({instance:f})=>{const{flag_clicked:y,tick:X,memory:W,step_funcs:g,vars_num:l,threads_count:A,requests_refresh:Y,upc:we,threads:R,noop:Se,unreachable_dbg:ve}=f.exports;window.memory=W,window.flag_clicked=y,window.tick=X,window.stop=()=>{if(typeof R>"u"){let F=new Uint32Array(W.buffer);for(let se=0;se<A.value;se++)F[se]=0}else for(let F=0;F<R.length;F++)R.set(F,Se);A.value=0},new DataView(W.buffer);try{ve()}catch(F){console.info("synthetic error to expose wasm module to devtools:",F)}y(),console.log("green_flag()"),m.draw();let $;e:for(;;){console.log("fps: %i",1e3/(Date.now()-$)),$=Date.now();do if(X(),A.value===0)break e;while(Date.now()-$<i*.8&&!e&&Y.value===0);Y.value=0,m.draw(),i>0?(console.log("sleeping for %i ms",i-(Date.now()-$)),await p(Math.max(0,i-(Date.now()-$)))):(console.log("waiting animation frame"),await E())}m.draw(),console.log("project stopped")}).catch(f=>{throw new Error(`error when instantiating module:
`+f.stack)})},f_={key:0},w_=["href"],u_=["href"],b_={key:1},d_=["innerHTML"],m_=["value"],p_={class:"instructions"},h_={key:0},y_={key:1},k_={__name:"ProjectPlayer",props:["json","title","author","assets","zip","instructions","description","id"],async setup(t){let e,n;const _=t;let s=D(null),a=D("loading"),c=D("An error"),w=D(!1),i=D(null),m=D("loading assets"),d=D(!1),h=null,p;const E=async g=>{try{return _.zip?await _.zip.file(g).async("text"):await(await fetch(`https://assets.scratch.mit.edu/internalapi/asset/${g}/get/`)).text()}catch(l){s.value=`failed to load asset ${g}
${l.stack}`}};let f,y;try{if(a.value="compiling",p=$e(JSON.stringify(_.json),T.from_js(Z().to_js())),console.log(p),!p instanceof z)throw new Error("unknown error occurred when compiling project");if(f=p.wasm_bytes,Z().to_js().wasm_opt=="On")try{console.log("loading binaryen..."),console.log(Z().to_js().scheduler);let g=([e,n]=Ae(()=>de(()=>import("./index-L0kWujx6.js"),__vite__mapDeps([2,3,4,5,6]))),e=await e,n(),e).default;console.log("optimising using wasm-opt..."),a.value="optimising",c.value="A warning";let l=g.readBinary(f);console.log(f.length),l.setFeatures(g.Features.All),g.setOptimizeLevel(3),g.setShrinkLevel(0),console.log(l.emitBinary().length),l.runPasses(["generate-global-effects"]),l.optimize(),console.log(l.emitBinary().length),console.log(l.emitBinary().length),l.optimize(),console.log(l.emitBinary().length),f=l.emitBinary(),console.log(f.length)}catch(g){console.error(g),s.value=g.message.toString(),g.stack&&(s.value+="<br>"+g.stack),s.value+="<br>See browser console for more info.        <brThis is not an unrecoverable error; the project should play         as normal (possibly with worse-than-expected performance).",y=!1}else console.log("skipping wasm-opt due to user settings");y=!0}catch(g){console.error(g),s.value=g.toString(),g.stack&&(s.value+="<br>"+g.stack),y=!1}console.log(p),Promise.all(_.json.targets.map(g=>new Promise(l=>Promise.all(g.costumes.map(({md5ext:A,dataFormat:Y})=>new Promise(we=>E(A).then(R=>we([A,{dataFormat:Y,data:R}]))))).then(l)))).then(g=>{h=Object.fromEntries(g.flat()),d.value=!0});function X(){y&&l_({framerate:30,canvas:i.value,turbo:w.value,wasm_bytes:f,string_consts:p.strings,target_names:p.target_names,project_json:_.json,assets:h}).catch(g=>{console.error(g),c.value="An error",a.value="running",s.value=g.toString(),g.stack&&(s.value+=`
`+g.stack)})}function W(){window.stop()}return(g,l)=>(O(),U(Oe,null,[Fe(u("div",null,[u("h1",null,M(_.title||"untitled"),1),u("span",null,"by "+M(_.author||"unknown"),1),t.id?(O(),U("div",f_,[u("a",{href:`https://scratch.mit.edu/projects/${_.id}/`},"View on Scratch",8,w_),l[0]||(l[0]=K(" | ",-1)),u("a",{href:`https://turbowarp.org/${_.id}/`},"View on TurboWarp",8,u_)])):q("",!0),S(s)?(O(),U("details",b_,[u("summary",null,M(S(c))+" was emitted whilst "+M(S(a))+" project. ",1),u("span",{innerHTML:S(s)},null,8,d_)])):q("",!0),u("div",null,[u("button",{onClick:X},"green flag"),u("button",{onClick:W},"stop"),u("input",{type:"checkbox",id:"turbo",value:S(w)},null,8,m_),l[1]||(l[1]=u("label",{for:"turbo"},"turbo mode",-1))]),u("canvas",{width:"480",height:"360",ref_key:"canvas",ref:i},null,512),u("div",p_,[_.instructions?(O(),U("div",h_,[l[2]||(l[2]=u("h2",null,"Instructions",-1)),K(" "+M(_.instructions),1)])):q("",!0),_.description?(O(),U("div",y_,[l[3]||(l[3]=u("h2",null,"Notes and credits",-1)),K(" "+M(_.description),1)])):q("",!0)])],512),[[Me,S(d)]]),S(d)?q("",!0):(O(),De(Ee,{key:0},{default:Te(()=>[K(M(S(m)),1)]),_:1}))],64))}},j_=xe(k_,[["__scopeId","data-v-9d02fee6"]]);export{j_ as P};
