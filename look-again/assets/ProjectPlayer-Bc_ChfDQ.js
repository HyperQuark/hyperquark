const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DE5YMg4u.js","assets/index-fD89lc8E.js","assets/index-Bh5bQtup.css","assets/index-BAMY2Nnw.js","assets/index-BATEtbik.js"])))=>i.map(i=>d[i]);
import{B as ve,C as ue,_ as xe,r as F,m as Ae,c as ge,o as ne,h as De,k as Fe,s as le,D as Me,u as S,a as b,d as H,t as U,w as Te,L as Ee,F as Oe}from"./index-fD89lc8E.js";import{_ as Le,g as Y}from"./settings-3y_wkTvD.js";const Ce="/hyperquark/look-again/assets/hyperquark_bg-D4ptlW0V.wasm";let s;function Pe(t){s=t}let X=null;function O(){return(X===null||X.byteLength===0)&&(X=new Uint8Array(s.memory.buffer)),X}let K=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});K.decode();const ze=2146435072;let _e=0;function Be(t,e){return _e+=e,_e>=ze&&(K=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),K.decode(),_e=e),K.decode(O().subarray(t,t+e))}function v(t,e){return t=t>>>0,Be(t,e)}function oe(t,e){return t=t>>>0,O().subarray(t/1,t/1+e)}function be(t){const e=s.__externref_table_alloc();return s.__wbindgen_export_2.set(e,t),e}function Ie(t,e){try{return t.apply(this,e)}catch(n){const _=be(n);s.__wbindgen_exn_store(_)}}function Z(t){return t==null}function se(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const r=t.description;return r==null?"Symbol":`Symbol(${r})`}if(e=="function"){const r=t.name;return typeof r=="string"&&r.length>0?`Function(${r})`:"Function"}if(Array.isArray(t)){const r=t.length;let a="[";r>0&&(a+=se(t[0]));for(let c=1;c<r;c++)a+=", "+se(t[c]);return a+="]",a}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let _;if(n&&n.length>1)_=n[1];else return toString.call(t);if(_=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:_}let u=0;const W=new TextEncoder;"encodeInto"in W||(W.encodeInto=function(t,e){const n=W.encode(t);return e.set(n),{read:t.length,written:n.length}});function j(t,e,n){if(n===void 0){const w=W.encode(t),i=e(w.length,1)>>>0;return O().subarray(i,i+w.length).set(w),u=w.length,i}let _=t.length,r=e(_,1)>>>0;const a=O();let c=0;for(;c<_;c++){const w=t.charCodeAt(c);if(w>127)break;a[r+c]=w}if(c!==_){c!==0&&(t=t.slice(c)),r=n(r,_,_=c+t.length*3,1)>>>0;const w=O().subarray(r+c,r+_),i=W.encodeInto(t,w);c+=i.written,r=n(r,_,c,1)>>>0}return u=c,r}let E=null;function x(){return(E===null||E.buffer.detached===!0||E.buffer.detached===void 0&&E.buffer!==s.memory.buffer)&&(E=new DataView(s.memory.buffer)),E}function Ve(t,e){if(!(t instanceof e))throw new Error(`expected instance of ${e.name}`)}function L(t){const e=s.__wbindgen_export_2.get(t);return s.__externref_table_dealloc(t),e}function Re(t,e){const n=j(t,s.__wbindgen_malloc,s.__wbindgen_realloc),_=u;Ve(e,M);var r=e.__destroy_into_raw();const a=s.sb3_to_wasm(n,_,r);if(a[2])throw L(a[1]);return C.__wrap(a[0])}function Ue(t,e){const n=e(t.length*1,1)>>>0;return O().set(t,n/1),u=t.length,n}function de(t,e){t=t>>>0;const n=x(),_=[];for(let r=t;r<t+4*e;r+=4)_.push(s.__wbindgen_export_2.get(n.getUint32(r,!0)));return s.__externref_drop_slice(t,e),_}function me(t,e){const n=e(t.length*4,4)>>>0;for(let _=0;_<t.length;_++){const r=be(t[_]);x().setUint32(n+4*_,r,!0)}return u=t.length,n}const fe=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>s.__wbg_finishedwasm_free(t>>>0,1));class C{static __wrap(e){e=e>>>0;const n=Object.create(C.prototype);return n.__wbg_ptr=e,fe.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,fe.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_finishedwasm_free(e,0)}get wasm_bytes(){const e=s.__wbg_get_finishedwasm_wasm_bytes(this.__wbg_ptr);var n=oe(e[0],e[1]).slice();return s.__wbindgen_free(e[0],e[1]*1,1),n}set wasm_bytes(e){const n=Ue(e,s.__wbindgen_malloc),_=u;s.__wbg_set_finishedwasm_wasm_bytes(this.__wbg_ptr,n,_)}get target_names(){const e=s.__wbg_get_finishedwasm_target_names(this.__wbg_ptr);var n=de(e[0],e[1]).slice();return s.__wbindgen_free(e[0],e[1]*4,4),n}set target_names(e){const n=me(e,s.__wbindgen_malloc),_=u;s.__wbg_set_finishedwasm_target_names(this.__wbg_ptr,n,_)}}Symbol.dispose&&(C.prototype[Symbol.dispose]=C.prototype.free);const we=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>s.__wbg_flaginfo_free(t>>>0,1));class q{static __wrap(e){e=e>>>0;const n=Object.create(q.prototype);return n.__wbg_ptr=e,we.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,we.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_flaginfo_free(e,0)}get name(){let e,n;try{const _=s.__wbg_get_flaginfo_name(this.__wbg_ptr);return e=_[0],n=_[1],v(_[0],_[1])}finally{s.__wbindgen_free(e,n,1)}}set name(e){const n=j(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=u;s.__wbg_set_flaginfo_name(this.__wbg_ptr,n,_)}get description(){let e,n;try{const _=s.__wbg_get_flaginfo_description(this.__wbg_ptr);return e=_[0],n=_[1],v(_[0],_[1])}finally{s.__wbindgen_free(e,n,1)}}set description(e){const n=j(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=u;s.__wbg_set_flaginfo_description(this.__wbg_ptr,n,_)}get ty(){let e,n;try{const _=s.__wbg_get_flaginfo_ty(this.__wbg_ptr);return e=_[0],n=_[1],v(_[0],_[1])}finally{s.__wbindgen_free(e,n,1)}}set ty(e){const n=j(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=u;s.__wbg_set_flaginfo_ty(this.__wbg_ptr,n,_)}wasm_features(e){const n=j(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=u,r=s.flaginfo_wasm_features(this.__wbg_ptr,n,_);let a;return r[0]!==0&&(a=de(r[0],r[1]).slice(),s.__wbindgen_free(r[0],r[1]*4,4)),a}to_js(){const e=s.flaginfo_to_js(this.__wbg_ptr);if(e[2])throw L(e[1]);return L(e[0])}}Symbol.dispose&&(q.prototype[Symbol.dispose]=q.prototype.free);const re=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(t=>s.__wbg_wasmflags_free(t>>>0,1));class M{static __wrap(e){e=e>>>0;const n=Object.create(M.prototype);return n.__wbg_ptr=e,re.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,re.unregister(this),e}free(){const e=this.__destroy_into_raw();s.__wbg_wasmflags_free(e,0)}get string_type(){return s.__wbg_get_wasmflags_string_type(this.__wbg_ptr)}set string_type(e){s.__wbg_set_wasmflags_string_type(this.__wbg_ptr,e)}get wasm_opt(){return s.__wbg_get_wasmflags_wasm_opt(this.__wbg_ptr)}set wasm_opt(e){s.__wbg_set_wasmflags_wasm_opt(this.__wbg_ptr,e)}get scheduler(){return s.__wbg_get_wasmflags_scheduler(this.__wbg_ptr)}set scheduler(e){s.__wbg_set_wasmflags_scheduler(this.__wbg_ptr,e)}get print_ir(){return s.__wbg_get_wasmflags_print_ir(this.__wbg_ptr)}set print_ir(e){s.__wbg_set_wasmflags_print_ir(this.__wbg_ptr,e)}get integers(){return s.__wbg_get_wasmflags_integers(this.__wbg_ptr)}set integers(e){s.__wbg_set_wasmflags_integers(this.__wbg_ptr,e)}constructor(e){const n=me(e,s.__wbindgen_malloc),_=u,r=s.wasmflags_new(n,_);return this.__wbg_ptr=r>>>0,re.register(this,this.__wbg_ptr,this),this}to_js(){const e=s.wasmflags_to_js(this.__wbg_ptr);if(e[2])throw L(e[1]);return L(e[0])}static from_js(e){const n=s.wasmflags_from_js(e);if(n[2])throw L(n[1]);return M.__wrap(n[0])}static flag_info(e){const n=j(e,s.__wbindgen_malloc,s.__wbindgen_realloc),_=u,r=s.wasmflags_flag_info(n,_);return q.__wrap(r)}}Symbol.dispose&&(M.prototype[Symbol.dispose]=M.prototype.free);function We(t,e){return Error(v(t,e))}function $e(t){return Object.entries(t)}function qe(){return Ie(function(t,e){globalThis.crypto.getRandomValues(oe(t,e))},arguments)}function Ne(t,e){return t[e>>>0]}function Ge(t,e){return t[e]}function Je(t){let e;try{e=t instanceof ArrayBuffer}catch{e=!1}return e}function He(t){let e;try{e=t instanceof Uint8Array}catch{e=!1}return e}function Xe(t){return t.length}function Ye(t){return t.length}function Ke(t,e){console.log(v(t,e))}function Qe(){return new Object}function Ze(){return new Array}function et(){return new Map}function tt(t){return new Uint8Array(t)}function nt(t,e,n){Uint8Array.prototype.set.call(oe(t,e),n)}function _t(t,e,n){t[e]=n}function rt(t,e,n){t[e>>>0]=n}function st(t,e,n){return t.set(e,n)}function ot(t,e){console.warn(v(t,e))}function it(t){const e=t,n=typeof e=="boolean"?e:void 0;return Z(n)?16777215:n?1:0}function at(t,e){const n=se(e),_=j(n,s.__wbindgen_malloc,s.__wbindgen_realloc),r=u;x().setInt32(t+4,r,!0),x().setInt32(t+0,_,!0)}function ct(t,e){return t in e}function gt(t){const e=t;return typeof e=="object"&&e!==null}function lt(t){return typeof t=="string"}function ft(t){return t===void 0}function wt(t,e){return t==e}function ut(t,e){const n=e,_=typeof n=="number"?n:void 0;x().setFloat64(t+8,Z(_)?0:_,!0),x().setInt32(t+0,!Z(_),!0)}function bt(t,e){const n=e,_=typeof n=="string"?n:void 0;var r=Z(_)?0:j(_,s.__wbindgen_malloc,s.__wbindgen_realloc),a=u;x().setInt32(t+4,a,!0),x().setInt32(t+0,r,!0)}function dt(t,e){throw new Error(v(t,e))}function mt(t){let e;try{e=+t}catch(_){e=_}return e}function pt(t,e){return v(t,e)}function ht(t){return t}function yt(){const t=s.__wbindgen_export_2,e=t.grow(4);t.set(0,void 0),t.set(e+0,void 0),t.set(e+1,null),t.set(e+2,!0),t.set(e+3,!1)}URL=globalThis.URL;const o=await Le({"./hyperquark_bg.js":{__wbg_log_aa56095730005220:Ke,__wbg_warn_696c245f3c7d1eea:ot,__wbg_getwithrefkey_1dc361bd10053bfe:Ge,__wbg_set_3f1d0b984ed272ed:_t,__wbg_new_638ebfaedbf32a5e:tt,__wbg_length_6bb7e81f9d7713e4:Ye,__wbg_prototypesetcall_3d4a26c1ed734349:nt,__wbg_instanceof_Uint8Array_9a8378d955933db7:He,__wbg_instanceof_ArrayBuffer_67f3012529f6a2dd:Je,__wbg_new_2ff1f68f3676ea53:et,__wbg_set_b7f1cf4fae26fe2a:st,__wbg_get_0da715ceaecea5c8:Ne,__wbg_new_1f3a344cf3123716:Ze,__wbg_set_90f6c0f7bd8c0415:rt,__wbg_length_186546c51cd61acd:Xe,__wbg_new_19c25a3f2fa63a02:Qe,__wbg_entries_2be2f15bd5554996:$e,__wbg_getRandomValues_38a1ff1ea09f6cc7:qe,__wbg_wbindgenin_d7a1ee10933d2d55:ct,__wbg_wbindgenthrow_451ec1a8469d7eb6:dt,__wbg_Error_e17e777aac105295:We,__wbg_wbindgenisobject_307a53c6bd97fbf8:gt,__wbg_wbindgenisstring_d4fa939789f003b0:lt,__wbg_wbindgennumberget_f74b4c7525ac05cb:ut,__wbg_wbindgenstringget_0f16a6ddddef376f:bt,__wbg_wbindgenbooleanget_3fe6f642c7d97746:it,__wbg_wbindgenisundefined_c4b71d073b92f3c5:ft,__wbg_wbindgenjsvallooseeq_9bec8c9be826bed1:wt,__wbg_wbindgentryintonumber_aef53fe1d23c5fd4:mt,__wbg_wbindgendebugstring_99ef257a3ddda34d:at,__wbindgen_init_externref_table:yt,__wbindgen_cast_2241b6af4c4b2941:pt,__wbindgen_cast_d6cd19b81560fd6e:ht}},Ce),kt=o.memory,St=o.sb3_to_wasm,jt=o.__wbg_finishedwasm_free,vt=o.__wbg_get_finishedwasm_target_names,xt=o.__wbg_get_finishedwasm_wasm_bytes,At=o.__wbg_set_finishedwasm_target_names,Dt=o.__wbg_set_finishedwasm_wasm_bytes,Ft=o.__wbg_flaginfo_free,Mt=o.__wbg_get_flaginfo_description,Tt=o.__wbg_get_flaginfo_name,Et=o.__wbg_get_flaginfo_ty,Ot=o.__wbg_get_wasmflags_integers,Lt=o.__wbg_get_wasmflags_print_ir,Ct=o.__wbg_get_wasmflags_scheduler,Pt=o.__wbg_get_wasmflags_string_type,zt=o.__wbg_get_wasmflags_wasm_opt,Bt=o.__wbg_set_flaginfo_description,It=o.__wbg_set_flaginfo_name,Vt=o.__wbg_set_flaginfo_ty,Rt=o.__wbg_set_wasmflags_integers,Ut=o.__wbg_set_wasmflags_print_ir,Wt=o.__wbg_set_wasmflags_scheduler,$t=o.__wbg_set_wasmflags_string_type,qt=o.__wbg_set_wasmflags_wasm_opt,Nt=o.__wbg_wasmflags_free,Gt=o.all_wasm_features,Jt=o.flaginfo_to_js,Ht=o.flaginfo_wasm_features,Xt=o.wasm_feature_detect_name,Yt=o.wasmflags_flag_info,Kt=o.wasmflags_from_js,Qt=o.wasmflags_new,Zt=o.wasmflags_to_js,en=o.__wbindgen_exn_store,tn=o.__externref_table_alloc,nn=o.__wbindgen_export_2,_n=o.__wbindgen_malloc,rn=o.__wbindgen_realloc,sn=o.__externref_table_dealloc,on=o.__wbindgen_free,an=o.__externref_drop_slice,pe=o.__wbindgen_start,cn=Object.freeze(Object.defineProperty({__proto__:null,__externref_drop_slice:an,__externref_table_alloc:tn,__externref_table_dealloc:sn,__wbg_finishedwasm_free:jt,__wbg_flaginfo_free:Ft,__wbg_get_finishedwasm_target_names:vt,__wbg_get_finishedwasm_wasm_bytes:xt,__wbg_get_flaginfo_description:Mt,__wbg_get_flaginfo_name:Tt,__wbg_get_flaginfo_ty:Et,__wbg_get_wasmflags_integers:Ot,__wbg_get_wasmflags_print_ir:Lt,__wbg_get_wasmflags_scheduler:Ct,__wbg_get_wasmflags_string_type:Pt,__wbg_get_wasmflags_wasm_opt:zt,__wbg_set_finishedwasm_target_names:At,__wbg_set_finishedwasm_wasm_bytes:Dt,__wbg_set_flaginfo_description:Bt,__wbg_set_flaginfo_name:It,__wbg_set_flaginfo_ty:Vt,__wbg_set_wasmflags_integers:Rt,__wbg_set_wasmflags_print_ir:Ut,__wbg_set_wasmflags_scheduler:Wt,__wbg_set_wasmflags_string_type:$t,__wbg_set_wasmflags_wasm_opt:qt,__wbg_wasmflags_free:Nt,__wbindgen_exn_store:en,__wbindgen_export_2:nn,__wbindgen_free:on,__wbindgen_malloc:_n,__wbindgen_realloc:rn,__wbindgen_start:pe,all_wasm_features:Gt,flaginfo_to_js:Jt,flaginfo_wasm_features:Ht,memory:kt,sb3_to_wasm:St,wasm_feature_detect_name:Xt,wasmflags_flag_info:Yt,wasmflags_from_js:Kt,wasmflags_new:Qt,wasmflags_to_js:Zt},Symbol.toStringTag,{value:"Module"}));Pe(cn);pe();let Q,ie=!1,$,ee,he,ye,ke;function gn(t,e,n,_,r){Q=t,$=Q.map(a=>null),console.log(Q,$),ee=e,he=n,ye=_,ke=r,ie=!0}function ln(){return ie}function P(){if(!ie)throw new Error("shared state must be set up before use!")}function z(){return P(),Q}function k(){return P(),ee}function ae(){return P(),he}function N(){return P(),ye}function fn(){return P(),ke}function B(t,e,n){P(),$[t]?ee.updateTextSkin($[t][0],e,n,!1):$[t]=ee.createSkin("text","sprite",e,n,!1)}function wn(t,e,n,_,r,a,c,w,i){k().penLine(ae(),{diameter:t,color4f:[a,c,w,i]},e,n,_,r)}function un(){k().penClear(ae())}function bn(t,e,n,_,r,a,c){k().penPoint(ae(),{diameter:t,color4f:[_,r,a,c]},e,n)}function dn(t){return Math.log(t)}function mn(t){return Math.sin(t)}function pn(t,e){return t.toLowerCase()===e.toLowerCase()}function hn(t,e){return t.toLowerCase().includes(e.toLowerCase())}function yn(){return Math.random()}function kn(t){return Math.acos(t)}function Sn(t){return Math.asin(t)}function jn(t){return Math.atan(t)}function vn(t){return Math.cos(t)}function xn(t){return Math.pow(10,t)}function An(t){switch(t=t%360,t){case-270:case 90:return 1/0;case-90:case 270:return-1/0;default:return Math.tan(Math.PI*t/180)}}function Dn(t,e){return t.toLowerCase()<e.toLowerCase()}function Fn(t,e){return t.toLowerCase()>e.toLowerCase()}function Mn(t){return Math.exp(t)}function Tn(t,e,n){return t.substring(e,n)}function En(t){return t.length}function On(t,e){return t.concat(e)}function Ln(){const e=new Date(2e3,0,1),n=new Date,_=n.getTimezoneOffset()-e.getTimezoneOffset();let r=n.valueOf()-e.valueOf();return r+=(n.getTimezoneOffset()-_)*60*1e3,r/864e5}function Cn(t){return parseFloat(t)}function Pn(t){return t.toString()}function zn(t){return t.toString()}function Bn(t,e){console.log("%s thinks: %d",z()[e],t)}function In(t,e){k().getDrawable(N()[e][1]).updateScale([t,t])}function Vn(t,e){console.log("%s says: %s",z()[e],t)}function Rn(t,e){B(e,"say",t.toString())}function Un(t,e){B(e,"say",t)}function Wn(t,e){const n=fn()[e][t];k().getSkin(N()[e][0]).setSVG(n.data)}function $n(t,e){B(e,"say",t.toString())}function qn(t,e){B(e,"think",t.toString())}function Nn(t,e){console.log("%s says: %d",z()[e],t)}function Gn(t,e){B(e,"think",t)}function Jn(t,e){console.log("%s says: %d",z()[e],t)}function Hn(t,e){console.log("%s thinks: %s",z()[e],t)}function Xn(t,e){k().getDrawable(N()[e][1]).updateVisible(t)}function Yn(t,e){console.log("%s thinks: %d",z()[e],t)}function Kn(t,e){B(e,"think",t.toString())}function Qn(t,e){k().getDrawable(N()[t][1]).updateDirection(e)}function Zn(t,e,n){k().getDrawable(N()[n][1]).updatePosition([t,e])}const e_={pen:{line:wn,clear:un,point:bn},looks:{think_debug_float:Bn,setsizeto:In,say_debug_string:Vn,say_int:Rn,say_string:Un,switchcostumeto:Wn,say_float:$n,think_float:qn,say_debug_int:Nn,think_string:Gn,say_debug_float:Jn,think_debug_string:Hn,setvisible:Xn,think_debug_int:Yn,think_int:Kn},"wasm:js-string":{substring:Tn,length:En,concat:On},sensing:{dayssince2000:Ln},operator:{log:dn,sin:mn,eq_string:pn,contains:hn,random:yn,acos:kn,asin:Sn,atan:jn,cos:vn,pow10:xn,tan:An,lt_string:Dn,gt_string:Fn,exp:Mn},motion:{pointindirection:Qn,gotoxy:Zn},cast:{string2float:Cn,float2string:Pn,int2string:zn}},t_=await ue(()=>import("./renderer-B_tnpBq2.js"),[]),n_=t_.default,__=ve();function r_(t,e,n,..._){let r=t.createDrawable(n.toString());const a={pen:"Pen",text:"Text",svg:"SVG"}[e.toLowerCase()];let c=t[`create${a}Skin`](..._);return t.updateDrawableSkinId(r,c),[c,r]}function s_(t,e,n,_){if(ln())return;let r=new n_(t);r.getDrawable=i=>r._allDrawables[i],r.getSkin=i=>r._allSkins[i],r.createSkin=(i,p,...d)=>r_(r,i,p,...d);const a=e.targets.map((i,p)=>i.costumes.map(({md5ext:d})=>n[d]));e.targets.map(i=>Object.fromEntries(i.costumes.map(({name:p},d)=>[p,d]))),window.renderer=r,r.setLayerGroupOrdering(["background","video","pen","sprite"]);const c=r.createSkin("pen","pen")[0],w=e.targets.map((i,p)=>{const d=i.costumes[i.currentCostume],h=a[p][i.currentCostume];if(h.dataFormat.toLowerCase()!=="svg")throw new Error("todo: non-svg costumes");const[m,T]=r.createSkin(h.dataFormat,"sprite",h.data,[d.rotationCenterX,d.rotationCenterY]),f=r.getDrawable(T);return i.is_stage||(f.updateVisible(!!i.visible),f.updatePosition([i.x,i.y]),f.updateDirection(i.direction),f.updateScale([i.size,i.size])),[m,T]});console.log(w),gn(_,r,c,w,a)}const o_=async({framerate:t=30,turbo:e,canvas:n,wasm_bytes:_,target_names:r,string_consts:a,project_json:c,assets:w}={framerate:30,turbo:!1})=>{__.debug&&window.open(URL.createObjectURL(new Blob([_],{type:"application/wasm"})));const i=Math.round(1e3/t);console.log("framerate_wait: %i",i),s_(n,c,w,r);const p=k();console.log("green flag setup complete");const h=[...Y()["js-string-builtins"]?["js-string"]:[]];try{if(!WebAssembly.validate(_,{builtins:h}))throw Error()}catch{try{throw new WebAssembly.Module(_),new Error("invalid WASM module")}catch(f){throw new Error("invalid WASM module: "+f.message)}}function m(f){return new Promise(y=>{setTimeout(y,f)})}function T(){return new Promise(f=>{requestAnimationFrame(f)})}WebAssembly.instantiate(_,e_,{builtins:h,importedStringConstants:""}).then(async({instance:f})=>{const{flag_clicked:y,tick:G,memory:I,step_funcs:g,vars_num:l,threads_count:A,requests_refresh:J,upc:ce,threads:V,noop:Se,unreachable_dbg:je}=f.exports;window.memory=I,window.flag_clicked=y,window.tick=G,window.stop=()=>{if(typeof V>"u"){let D=new Uint32Array(I.buffer);for(let te=0;te<A.value;te++)D[te]=0}else for(let D=0;D<V.length;D++)V.set(D,Se);A.value=0},new DataView(I.buffer);try{je()}catch(D){console.info("synthetic error to expose wasm module to devtools:",D)}y(),console.log("green_flag()");let R;e:for(;;){console.log("fps: %i",1e3/(Date.now()-R)),R=Date.now(),p.draw();do if(G(),A.value===0)break e;while(Date.now()-R<i*.8&&!e&&J.value===0);J.value=0,i>0?(console.log("sleeping for %i ms",i-(Date.now()-R)),await m(Math.max(0,i-(Date.now()-R)))):(console.log("waiting animation frame"),await T())}console.log("project stopped")}).catch(f=>{throw new Error(`error when instantiating module:
`+f.stack)})},i_=["value"],a_={key:0},c_=["innerHTML"],g_={__name:"ProjectPlayer",props:["json","title","author","assets","zip"],async setup(t){let e,n;const _=t;let r=F(null),a=F("loading"),c=F("An error"),w=F(!1),i=F(null),p=F("loading assets"),d=F(!1),h=null,m;const T=async g=>{try{return _.zip?await _.zip.file(g).async("text"):await(await fetch(`https://assets.scratch.mit.edu/internalapi/asset/${g}/get/`)).text()}catch(l){r.value=`failed to load asset ${g}
${l.stack}`}};let f,y;try{if(a.value="compiling",m=Re(JSON.stringify(_.json),M.from_js(Y().to_js())),console.log(m),!m instanceof C)throw new Error("unknown error occurred when compiling project");if(f=m.wasm_bytes,Y().to_js().wasm_opt=="On")try{console.log("loading binaryen..."),console.log(Y().to_js().scheduler);let g=([e,n]=Ae(()=>ue(()=>import("./index-DE5YMg4u.js"),__vite__mapDeps([0,1,2,3,4]))),e=await e,n(),e).default;console.log("optimising using wasm-opt..."),a.value="optimising",c.value="A warning";let l=g.readBinary(f);console.log(f.length),l.setFeatures(g.Features.All),g.setOptimizeLevel(3),g.setShrinkLevel(0),console.log(l.emitBinary().length),l.runPasses(["generate-global-effects"]),l.optimize(),console.log(l.emitBinary().length),console.log(l.emitBinary().length),l.optimize(),console.log(l.emitBinary().length),f=l.emitBinary(),console.log(f.length)}catch(g){console.error(g),r.value=g.message.toString(),g.stack&&(r.value+="<br>"+g.stack),r.value+="<br>See browser console for more info.        <brThis is not an unrecoverable error; the project should play         as normal (possibly with worse-than-expected performance).",y=!1}else console.log("skipping wasm-opt due to user settings");y=!0}catch(g){console.error(g),r.value=g.toString(),g.stack&&(r.value+="<br>"+g.stack),y=!1}console.log(m),Promise.all(_.json.targets.map(g=>new Promise(l=>Promise.all(g.costumes.map(({md5ext:A,dataFormat:J})=>new Promise(ce=>T(A).then(V=>ce([A,{dataFormat:J,data:V}]))))).then(l)))).then(g=>{h=Object.fromEntries(g.flat()),d.value=!0});function G(){y&&o_({framerate:30,canvas:i.value,turbo:w.value,wasm_bytes:f,string_consts:m.strings,target_names:m.target_names,project_json:_.json,assets:h}).catch(g=>{console.error(g),c.value="An error",a.value="running",r.value=g.toString(),g.stack&&(r.value+=`
`+g.stack)})}function I(){window.stop()}return(g,l)=>(ne(),ge(Oe,null,[De(b("div",null,[b("h1",null,U(_.title||"untitled"),1),b("span",null,"by "+U(_.author||"unknown"),1),b("input",{type:"checkbox",id:"turbo",value:S(w)},null,8,i_),l[0]||(l[0]=H()),l[1]||(l[1]=b("label",{for:"turbo"},"turbo mode",-1)),S(r)?(ne(),ge("details",a_,[b("summary",null,U(S(c))+" was emitted whilst "+U(S(a))+" project.",1),b("span",{innerHTML:S(r)},null,8,c_)])):le("",!0),l[2]||(l[2]=b("br",null,null,-1)),l[3]||(l[3]=b("br",null,null,-1)),b("button",{onClick:G},"green flag"),l[4]||(l[4]=H()),b("button",{onClick:I},"stop"),b("canvas",{width:"480",height:"360",ref_key:"canvas",ref:i},null,512),l[5]||(l[5]=b("div",{id:"hq-output"},[H("Project output:"),b("br")],-1))],512),[[Me,S(d)]]),S(d)?le("",!0):(ne(),Fe(Ee,{key:0},{default:Te(()=>[H(U(S(p)),1)]),_:1}))],64))}},w_=xe(g_,[["__scopeId","data-v-d692cea2"]]);export{w_ as P};
